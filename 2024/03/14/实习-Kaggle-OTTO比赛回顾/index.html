<!DOCTYPE html>
<html lang=zh>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- å¼ºåˆ¶é¡µé¢åœ¨å½“å‰çª—å£ä»¥ç‹¬ç«‹é¡µé¢æ˜¾ç¤º,é˜²æ­¢åˆ«äººåœ¨æ¡†æ¶é‡Œè°ƒç”¨é¡µé¢ -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>Kaggle-OTTOæ¯”èµ›å›é¡¾ | Gladdduck</title>
  <meta name="description" content="1. æ¯”èµ›ä»»åŠ¡ The goal of this competition is to predict e-commerce clicks, cart additions, and orders. Youâ€™ll build a multi-objective recommender system based on previous events in a user session. è¿™åœºæ¯”èµ›çš„ç›®æ ‡">
<meta property="og:type" content="article">
<meta property="og:title" content="Kaggle-OTTOæ¯”èµ›å›é¡¾">
<meta property="og:url" content="https://gladdduck.github.io/2024/03/14/%E5%AE%9E%E4%B9%A0-Kaggle-OTTO%E6%AF%94%E8%B5%9B%E5%9B%9E%E9%A1%BE/index.html">
<meta property="og:site_name" content="Gladdduck">
<meta property="og:description" content="1. æ¯”èµ›ä»»åŠ¡ The goal of this competition is to predict e-commerce clicks, cart additions, and orders. Youâ€™ll build a multi-objective recommender system based on previous events in a user session. è¿™åœºæ¯”èµ›çš„ç›®æ ‡">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://image.yayan.xyz/20240314194614.png">
<meta property="og:image" content="https://image.yayan.xyz/20240314194528.png">
<meta property="og:image" content="https://image.yayan.xyz/20240314190025.png">
<meta property="og:image" content="https://image.yayan.xyz/20240314194910.png">
<meta property="og:image" content="https://image.yayan.xyz/20240316125957.png">
<meta property="article:published_time" content="2024-03-14T10:50:22.943Z">
<meta property="article:modified_time" content="2024-03-16T05:34:08.341Z">
<meta property="article:author" content="syxue">
<meta property="article:tag" content="Kaggle">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://image.yayan.xyz/20240314194614.png">
  <!-- Canonical links -->
  <link rel="canonical" href="https://gladdduck.github.io/2024/03/14/%E5%AE%9E%E4%B9%A0-Kaggle-OTTO%E6%AF%94%E8%B5%9B%E5%9B%9E%E9%A1%BE/index.html">
  
    <link rel="alternate" href="/atom.xml" title="Gladdduck" type="application/atom+xml">
  
  
    <link rel="icon" href="/icon.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
  
  
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1.4.0/dist/gitalk.min.css">
  
<meta name="generator" content="Hexo 5.4.2"></head>


<body class="main-center theme-purple" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="https://github.com/gladdduck" target="_blank">
          <img class="img-circle img-rotate" src="/images/icon.png" width="200" height="200">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">Gladdduck</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md">KB Master</h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Suzhou, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="æœç´¢" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="æƒ³è¦æŸ¥æ‰¾ä»€ä¹ˆ..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">Ã—</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav menu-highlight">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">é¦–é¡µ</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">å½’æ¡£</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="icon icon-folder"></i>
            
            <span class="menu-title">åˆ†ç±»</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-repository">
          <a href="/repository">
            
            <i class="icon icon-project"></i>
            
            <span class="menu-title">é¡¹ç›®</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-picture">
          <a href="/picturewall">
            
            <i class="icon icon-starfish"></i>
            
            <span class="menu-title">å›¾ç‰‡å¢™</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-about">
          <a href="/about">
            
            <i class="icon icon-cup-fill"></i>
            
            <span class="menu-title">å…³äº</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/gladdduck" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">å…¬å‘Š</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p>è‡ªå·±JBçš„è®°å½•</p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">åˆ†ç±»</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/hexo%E5%8D%9A%E5%AE%A2%E9%85%8D%E7%BD%AE/">hexoåšå®¢é…ç½®</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">å­¦ä¹ ç¬”è®°</a><span class="category-list-count">30</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BF%AB%E6%8D%B7%E5%91%BD%E4%BB%A4/">å¿«æ·å‘½ä»¤</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB%E9%85%8D%E7%BD%AE/">æ‚ä¸ƒæ‚å…«é…ç½®</a><span class="category-list-count">11</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9D%82%E8%B0%88/">æ‚è°ˆ</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%BA%E6%96%87%E8%AE%B0%E5%BD%95/">è®ºæ–‡è®°å½•</a><span class="category-list-count">6</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">æ ‡ç­¾</h3>
    <div class="widget-body">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/BingChat/" rel="tag">BingChat</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Blazor/" rel="tag">Blazor</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BlazorLocalization/" rel="tag">BlazorLocalization</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSharp/" rel="tag">CSharp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cypher/" rel="tag">Cypher</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Dataloader/" rel="tag">Dataloader</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Dataset/" rel="tag">Dataset</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Few-shotObjectDetection/" rel="tag">Few-shotObjectDetection</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/" rel="tag">Git</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hadoop/" rel="tag">Hadoop</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/" rel="tag">Hexo</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kaggle/" rel="tag">Kaggle</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux%E5%BF%AB%E6%8D%B7%E5%91%BD%E4%BB%A4/" rel="tag">Linuxå¿«æ·å‘½ä»¤</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Neo4j%E5%BF%AB%E6%8D%B7%E5%91%BD%E4%BB%A4/" rel="tag">Neo4jå¿«æ·å‘½ä»¤</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PaddleOCRSharp/" rel="tag">PaddleOCRSharp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="tag">Pythonå­¦ä¹ ç¬”è®°</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQL/" rel="tag">SQL</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sampler/" rel="tag">Sampler</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VS2022/" rel="tag">VS2022</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VSCode-Github/" rel="tag">VSCode Github</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vscode/" rel="tag">Vscode</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vscode-%E9%98%BF%E9%87%8C%E4%BA%91/" rel="tag">Vscode é˜¿é‡Œäº‘</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Zero-shot-Detection/" rel="tag">Zero-shot Detection</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/collate-fn/" rel="tag">collate_fn</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git-Time-out/" rel="tag">git Time out</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo%E5%8D%9A%E5%AE%A2%E9%85%8D%E7%BD%AEgitalk/" rel="tag">hexoåšå®¢é…ç½®gitalk</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo%E5%8D%9A%E5%AE%A2%E9%85%8D%E7%BD%AEpicgo/" rel="tag">hexoåšå®¢é…ç½®picgo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo%E5%8D%9A%E5%AE%A2%E9%85%8D%E7%BD%AEpure/" rel="tag">hexoåšå®¢é…ç½®pure</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mmfewshot/" rel="tag">mmfewshot</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/neo4j%E5%AE%89%E8%A3%85/" rel="tag">neo4jå®‰è£…</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python3-%E6%A0%87%E5%87%86%E5%BA%93/" rel="tag">python3 æ ‡å‡†åº“</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB/" rel="tag">ä»£ç é˜…è¯»</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9E%83%E5%9C%BE%E6%A3%80%E6%B5%8B/" rel="tag">åƒåœ¾æ£€æµ‹</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%9A%E4%B8%AA%E5%9F%9F%E5%90%8D%E8%AE%BF%E9%97%AE%E5%90%8C%E4%B8%80%E4%B8%AA%E6%9C%8D%E5%8A%A1%E5%99%A8/" rel="tag">å¤šä¸ªåŸŸåè®¿é—®åŒä¸€ä¸ªæœåŠ¡å™¨</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AE%9E%E4%B9%A0%E7%AC%94%E8%AF%95/" rel="tag">å®ä¹ ç¬”è¯•</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AE%9E%E4%B9%A0%E9%9D%A2%E7%BB%8F/" rel="tag">å®ä¹ é¢ç»</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BF%AB%E6%8D%B7%E9%94%AE/" rel="tag">å¿«æ·é”®</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BF%AB%E9%80%9F%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2/" rel="tag">å¿«é€Ÿå‚…é‡Œå¶å˜æ¢</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/" rel="tag">æ’åºç®—æ³•</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/" rel="tag">æ­å»ºåšå®¢</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B%E4%BC%9A%E8%AE%AE/" rel="tag">ç›®æ ‡æ£€æµ‹ä¼šè®®</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1%E8%A1%A8%E7%A4%BA/" rel="tag">çŸ¥è¯†å›¾è°±è¡¨ç¤º</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%9F%A5%E8%AF%86%E7%82%B9/" rel="tag">çŸ¥è¯†ç‚¹</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98%E7%AC%94%E8%AE%B0/" rel="tag">ç®—æ³•åˆ·é¢˜ç¬”è®°</a><span class="tag-list-count">7</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">æ ‡ç­¾äº‘</h3>
    <div class="widget-body tagcloud">
      <a href="/tags/BingChat/" style="font-size: 13px;">BingChat</a> <a href="/tags/Blazor/" style="font-size: 13px;">Blazor</a> <a href="/tags/BlazorLocalization/" style="font-size: 13px;">BlazorLocalization</a> <a href="/tags/CSharp/" style="font-size: 13px;">CSharp</a> <a href="/tags/Cypher/" style="font-size: 13px;">Cypher</a> <a href="/tags/Dataloader/" style="font-size: 13px;">Dataloader</a> <a href="/tags/Dataset/" style="font-size: 13px;">Dataset</a> <a href="/tags/Few-shotObjectDetection/" style="font-size: 13.33px;">Few-shotObjectDetection</a> <a href="/tags/Git/" style="font-size: 13px;">Git</a> <a href="/tags/Hadoop/" style="font-size: 13px;">Hadoop</a> <a href="/tags/Hexo/" style="font-size: 13.33px;">Hexo</a> <a href="/tags/Kaggle/" style="font-size: 13px;">Kaggle</a> <a href="/tags/Linux%E5%BF%AB%E6%8D%B7%E5%91%BD%E4%BB%A4/" style="font-size: 13px;">Linuxå¿«æ·å‘½ä»¤</a> <a href="/tags/MySQL/" style="font-size: 13px;">MySQL</a> <a href="/tags/Neo4j%E5%BF%AB%E6%8D%B7%E5%91%BD%E4%BB%A4/" style="font-size: 13px;">Neo4jå¿«æ·å‘½ä»¤</a> <a href="/tags/PaddleOCRSharp/" style="font-size: 13px;">PaddleOCRSharp</a> <a href="/tags/Python%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" style="font-size: 13.67px;">Pythonå­¦ä¹ ç¬”è®°</a> <a href="/tags/SQL/" style="font-size: 13px;">SQL</a> <a href="/tags/Sampler/" style="font-size: 13px;">Sampler</a> <a href="/tags/VS2022/" style="font-size: 13px;">VS2022</a> <a href="/tags/VSCode-Github/" style="font-size: 13px;">VSCode Github</a> <a href="/tags/Vscode/" style="font-size: 13px;">Vscode</a> <a href="/tags/Vscode-%E9%98%BF%E9%87%8C%E4%BA%91/" style="font-size: 13px;">Vscode é˜¿é‡Œäº‘</a> <a href="/tags/Zero-shot-Detection/" style="font-size: 13px;">Zero-shot Detection</a> <a href="/tags/collate-fn/" style="font-size: 13px;">collate_fn</a> <a href="/tags/git-Time-out/" style="font-size: 13px;">git Time out</a> <a href="/tags/hexo%E5%8D%9A%E5%AE%A2%E9%85%8D%E7%BD%AEgitalk/" style="font-size: 13px;">hexoåšå®¢é…ç½®gitalk</a> <a href="/tags/hexo%E5%8D%9A%E5%AE%A2%E9%85%8D%E7%BD%AEpicgo/" style="font-size: 13px;">hexoåšå®¢é…ç½®picgo</a> <a href="/tags/hexo%E5%8D%9A%E5%AE%A2%E9%85%8D%E7%BD%AEpure/" style="font-size: 13px;">hexoåšå®¢é…ç½®pure</a> <a href="/tags/mmfewshot/" style="font-size: 13px;">mmfewshot</a> <a href="/tags/neo4j%E5%AE%89%E8%A3%85/" style="font-size: 13px;">neo4jå®‰è£…</a> <a href="/tags/python3-%E6%A0%87%E5%87%86%E5%BA%93/" style="font-size: 13.67px;">python3 æ ‡å‡†åº“</a> <a href="/tags/%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB/" style="font-size: 13px;">ä»£ç é˜…è¯»</a> <a href="/tags/%E5%9E%83%E5%9C%BE%E6%A3%80%E6%B5%8B/" style="font-size: 13px;">åƒåœ¾æ£€æµ‹</a> <a href="/tags/%E5%A4%9A%E4%B8%AA%E5%9F%9F%E5%90%8D%E8%AE%BF%E9%97%AE%E5%90%8C%E4%B8%80%E4%B8%AA%E6%9C%8D%E5%8A%A1%E5%99%A8/" style="font-size: 13px;">å¤šä¸ªåŸŸåè®¿é—®åŒä¸€ä¸ªæœåŠ¡å™¨</a> <a href="/tags/%E5%AE%9E%E4%B9%A0%E7%AC%94%E8%AF%95/" style="font-size: 13px;">å®ä¹ ç¬”è¯•</a> <a href="/tags/%E5%AE%9E%E4%B9%A0%E9%9D%A2%E7%BB%8F/" style="font-size: 13px;">å®ä¹ é¢ç»</a> <a href="/tags/%E5%BF%AB%E6%8D%B7%E9%94%AE/" style="font-size: 13px;">å¿«æ·é”®</a> <a href="/tags/%E5%BF%AB%E9%80%9F%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2/" style="font-size: 13px;">å¿«é€Ÿå‚…é‡Œå¶å˜æ¢</a> <a href="/tags/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/" style="font-size: 13px;">æ’åºç®—æ³•</a> <a href="/tags/%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/" style="font-size: 13.33px;">æ­å»ºåšå®¢</a> <a href="/tags/%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B%E4%BC%9A%E8%AE%AE/" style="font-size: 13px;">ç›®æ ‡æ£€æµ‹ä¼šè®®</a> <a href="/tags/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1%E8%A1%A8%E7%A4%BA/" style="font-size: 13px;">çŸ¥è¯†å›¾è°±è¡¨ç¤º</a> <a href="/tags/%E7%9F%A5%E8%AF%86%E7%82%B9/" style="font-size: 13px;">çŸ¥è¯†ç‚¹</a> <a href="/tags/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98%E7%AC%94%E8%AE%B0/" style="font-size: 14px;">ç®—æ³•åˆ·é¢˜ç¬”è®°</a>
    </div>
  </div>

    
      
  <div class="widget">
    <h3 class="widget-title">å½’æ¡£</h3>
    <div class="widget-body">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">ä¸‰æœˆ 2024</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">åäºŒæœˆ 2023</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">åä¸€æœˆ 2023</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/10/">åæœˆ 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/09/">ä¹æœˆ 2023</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/06/">å…­æœˆ 2023</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">å››æœˆ 2023</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">ä¸‰æœˆ 2023</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">äºŒæœˆ 2023</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">åäºŒæœˆ 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/11/">åä¸€æœˆ 2022</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">åæœˆ 2022</a><span class="archive-list-count">8</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">æœ€æ–°æ–‡ç« </h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled ">
        
          <li>
            
            <div class="item-thumb">
              <a href="/2024/03/26/%E5%AE%9E%E4%B9%A0-SQL%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/" class="thumb">
    
    
        <span class="thumb-image thumb-none"></span>
    
</a>

            </div>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">å­¦ä¹ ç¬”è®°</a>
              </p>
              <p class="item-title">
                <a href="/2024/03/26/%E5%AE%9E%E4%B9%A0-SQL%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/" class="title">SQLåˆ·é¢˜ç¬”è®°</a>
              </p>
              <p class="item-date">
                <time datetime="2024-03-26T11:45:00.778Z" itemprop="datePublished">2024-03-26</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-thumb">
              <a href="/2024/03/26/%E5%AE%9E%E4%B9%A0-2024%E5%AE%9E%E4%B9%A0%E9%9D%A2%E7%BB%8F/" class="thumb">
    
    
        <span class="thumb-image thumb-none"></span>
    
</a>

            </div>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">å­¦ä¹ ç¬”è®°</a>
              </p>
              <p class="item-title">
                <a href="/2024/03/26/%E5%AE%9E%E4%B9%A0-2024%E5%AE%9E%E4%B9%A0%E9%9D%A2%E7%BB%8F/" class="title">2024æš‘æœŸå®ä¹ é¢ç»</a>
              </p>
              <p class="item-date">
                <time datetime="2024-03-26T08:12:27.672Z" itemprop="datePublished">2024-03-26</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-thumb">
              <a href="/2024/03/23/%E5%AE%9E%E4%B9%A0-MySQL%E7%9F%A5%E8%AF%86%E7%82%B9/" class="thumb">
    
    
        <span class="thumb-image thumb-none"></span>
    
</a>

            </div>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">å­¦ä¹ ç¬”è®°</a>
              </p>
              <p class="item-title">
                <a href="/2024/03/23/%E5%AE%9E%E4%B9%A0-MySQL%E7%9F%A5%E8%AF%86%E7%82%B9/" class="title">MySQLå­¦ä¹ ç¬”è®°</a>
              </p>
              <p class="item-date">
                <time datetime="2024-03-23T04:16:40.569Z" itemprop="datePublished">2024-03-23</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-thumb">
              <a href="/2024/03/18/%E5%AE%9E%E4%B9%A0-2024%E5%AE%9E%E4%B9%A0%E7%AC%94%E8%AF%95/" class="thumb">
    
    
        <span class="thumb-image thumb-none"></span>
    
</a>

            </div>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">å­¦ä¹ ç¬”è®°</a>
              </p>
              <p class="item-title">
                <a href="/2024/03/18/%E5%AE%9E%E4%B9%A0-2024%E5%AE%9E%E4%B9%A0%E7%AC%94%E8%AF%95/" class="title">2024ç¾å›¢æ˜¥æ‹›ç¬”è¯•</a>
              </p>
              <p class="item-date">
                <time datetime="2024-03-18T13:28:14.565Z" itemprop="datePublished">2024-03-18</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-thumb">
              <a href="/2024/03/16/%E5%AE%9E%E4%B9%A0-Hadoop%E7%9F%A5%E8%AF%86%E7%82%B9/" class="thumb">
    
    
        <span class="thumb-image thumb-none"></span>
    
</a>

            </div>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">å­¦ä¹ ç¬”è®°</a>
              </p>
              <p class="item-title">
                <a href="/2024/03/16/%E5%AE%9E%E4%B9%A0-Hadoop%E7%9F%A5%E8%AF%86%E7%82%B9/" class="title">Hadoopå­¦ä¹ ç¬”è®°</a>
              </p>
              <p class="item-date">
                <time datetime="2024-03-16T08:26:52.655Z" itemprop="datePublished">2024-03-16</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
  <aside class="sidebar sidebar-toc collapse   in  " id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <nav id="toc" class="article-toc">
      <h3 class="toc-title">æ–‡ç« ç›®å½•</h3>
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%AF%94%E8%B5%9B%E4%BB%BB%E5%8A%A1"><span class="toc-number">1.</span> <span class="toc-text"> 1. æ¯”èµ›ä»»åŠ¡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="toc-number">2.</span> <span class="toc-text"> 2. æ•°æ®é›†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E6%80%9D%E8%B7%AF"><span class="toc-number">3.</span> <span class="toc-text"> 3. æ€è·¯</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#candidate-generation"><span class="toc-number">3.1.</span> <span class="toc-text"> Candidate Generation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#what-is-the-co-visitation-matrix-really"><span class="toc-number">3.2.</span> <span class="toc-text"> What is the co-visitation matrix, really?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#candidate-rerank-model-lb-0575"><span class="toc-number">3.3.</span> <span class="toc-text"> Candidate ReRank Model - [LB 0.575]</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%80%99%E9%80%89%E5%95%86%E5%93%81%E7%94%9F%E6%88%90"><span class="toc-number">3.3.1.</span> <span class="toc-text"> å€™é€‰å•†å“ç”Ÿæˆ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E6%8E%92%E5%90%8D%E4%B8%8E%E6%9C%80%E7%BB%88%E9%80%89%E6%8B%A9"><span class="toc-number">3.3.2.</span> <span class="toc-text"> é‡æ’åä¸æœ€ç»ˆé€‰æ‹©</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#co-visitation-matrix"><span class="toc-number">3.4.</span> <span class="toc-text"> Co-visitation Matrix</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%80%99%E9%80%89%E5%95%86%E5%93%81%E7%94%9F%E6%88%90-2"><span class="toc-number">3.4.1.</span> <span class="toc-text"> å€™é€‰å•†å“ç”Ÿæˆ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E6%8E%92%E5%90%8D%E4%B8%8E%E6%9C%80%E7%BB%88%E9%80%89%E6%8B%A9-2"><span class="toc-number">3.4.2.</span> <span class="toc-text"> é‡æ’åä¸æœ€ç»ˆé€‰æ‹©</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#how-to-build-a-gbt-ranker-model"><span class="toc-number">3.5.</span> <span class="toc-text"> How To Build a GBT Ranker Model</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#word2vec-how-to-training-and-submission"><span class="toc-number">3.6.</span> <span class="toc-text"> ğŸ’¡ Word2Vec How-to [training and submission]ğŸš€ğŸš€ğŸš€</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8word2vec%E7%9B%B4%E6%8E%A5%E8%8E%B7%E5%8F%9620%E4%B8%AA%E5%95%86%E5%93%81"><span class="toc-number">3.6.1.</span> <span class="toc-text"> ä½¿ç”¨word2vecç›´æ¥è·å–20ä¸ªå•†å“</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8word2vec-%E8%8E%B7%E5%8F%96%E5%80%99%E9%80%89%E5%95%86%E5%93%81"><span class="toc-number">3.6.2.</span> <span class="toc-text"> ä½¿ç”¨word2vec è·å–å€™é€‰å•†å“</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#matrix-factorization-pytorchmerlin-dataloader"><span class="toc-number">3.7.</span> <span class="toc-text"> ğŸ’¡Matrix Factorization [PyTorch+Merlin Dataloader]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#226th-place-solution-two-cents-from-a-first-timer"><span class="toc-number">3.8.</span> <span class="toc-text"> 226th (?!) Place Solution &amp; Two-cents from a First-timer</span></a></li></ol></li></ol>
    </nav>
  </div>
</aside>

<main class="main" role="main">
  <div class="content">
  <article id="post-å®ä¹ -Kaggle-OTTOæ¯”èµ›å›é¡¾" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      Kaggle-OTTOæ¯”èµ›å›é¡¾
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2024/03/14/%E5%AE%9E%E4%B9%A0-Kaggle-OTTO%E6%AF%94%E8%B5%9B%E5%9B%9E%E9%A1%BE/" class="article-date">
	  <time datetime="2024-03-14T10:50:22.943Z" itemprop="datePublished">2024-03-14</time>
	</a>
</span>
        
  <span class="article-category">
    <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">å­¦ä¹ ç¬”è®°</a>
  </span>

        
  <span class="article-tag">
    <i class="icon icon-tags"></i>
	<a class="article-tag-link-link" href="/tags/Kaggle/" rel="tag">Kaggle</a>
  </span>


        
	<span class="article-read hidden-xs">
	    <i class="icon icon-eye-fill" aria-hidden="true"></i>
	    <span id="busuanzi_container_page_pv">
			<span id="busuanzi_value_page_pv">0</span>
		</span>
	</span>


        <span class="post-comment"><i class="icon icon-comment"></i> <a href="/2024/03/14/%E5%AE%9E%E4%B9%A0-Kaggle-OTTO%E6%AF%94%E8%B5%9B%E5%9B%9E%E9%A1%BE/#comments" class="article-comment-link">è¯„è®º</a></span>
        
	
		<span class="post-wordcount hidden-xs" itemprop="wordCount">å­—æ•°ç»Ÿè®¡: 8.6k(å­—)</span>
	
	
		<span class="post-readcount hidden-xs" itemprop="timeRequired">é˜…è¯»æ—¶é•¿: 40(åˆ†)</span>
	

      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <h2 id="1-æ¯”èµ›ä»»åŠ¡"><a class="markdownIt-Anchor" href="#1-æ¯”èµ›ä»»åŠ¡"></a> 1. æ¯”èµ›ä»»åŠ¡</h2>
<p>The goal of this competition is to predict e-commerce clicks, cart additions, and orders. Youâ€™ll build a multi-objective recommender system based on previous events in a user session.</p>
<p>è¿™åœºæ¯”èµ›çš„ç›®æ ‡æ˜¯é¢„æµ‹ç”µå­å•†åŠ¡ç‚¹å‡»é‡ã€è´­ç‰©è½¦æ·»åŠ é‡å’Œè®¢å•ã€‚æ‚¨å°†åŸºäºç”¨æˆ·ä¼šè¯ä¸­ä»¥å‰çš„äº‹ä»¶æ„å»ºä¸€ä¸ªå¤šç›®æ ‡æ¨èç³»ç»Ÿã€‚</p>
<p>The training data contains full e-commerce session information. For each session in the test data, your task it to predict the aid values for each session type thats occur after the last timestamp ts in the test session. In other words, the test data contains sessions truncated by timestamp, and you are to predict what occurs after the point of truncation.</p>
<p>è®­ç»ƒæ•°æ®åŒ…å«å®Œæ•´çš„ç”µå­å•†åŠ¡ä¼šè¯ä¿¡æ¯ã€‚å¯¹äºæµ‹è¯•æ•°æ®ä¸­çš„æ¯ä¸ªä¼šè¯ï¼Œæ‚¨çš„ä»»åŠ¡æ˜¯é¢„æµ‹æµ‹è¯•ä¼šè¯ä¸­æœ€åä¸€ä¸ªæ—¶é—´æˆ³tsä¹‹åå‡ºç°çš„æ¯ä¸ªä¼šè¯ç±»å‹çš„å•†å“ç¼–å·(20ä¸ª)ã€‚æ¢å¥è¯è¯´ï¼Œæµ‹è¯•æ•°æ®åŒ…å«æŒ‰æ—¶é—´æˆ³æˆªæ–­çš„ä¼šè¯ï¼Œæ‚¨è¦é¢„æµ‹æˆªæ–­ç‚¹ä¹‹åä¼šå‘ç”Ÿä»€ä¹ˆã€‚</p>
<p><strong>æ€»ç»“:</strong> ç»™å®šæ¯ä¸ªç”¨æˆ·æ¯ä¸ªæ—¶åˆ»çš„è¡Œä¸º(ç‚¹å‡»,åŠ è´­,ä»˜æ¬¾)çš„å•†å“ç¼–å·,ç»™å‡ºä¸‹ä¸€ä¸ªæ—¶åˆ»,è¯¥ç”¨æˆ·ä¸‰ç§è¡Œä¸ºæœ€å¯èƒ½çš„20ä¸ªå•†å“ç¼–å·.</p>
<h2 id="2-æ•°æ®é›†"><a class="markdownIt-Anchor" href="#2-æ•°æ®é›†"></a> 2. æ•°æ®é›†</h2>
<p><strong>æ•°æ®æè¿°:</strong><br />
<img src="https://image.yayan.xyz/20240314194614.png" alt="" /></p>
<blockquote>
<p>2,899,779 sessions<br />
1,855,603 items<br />
216,716,096 events<br />
194,720,954 clicks<br />
16,896,191 carts<br />
5,098,951 orders</p>
</blockquote>
<p><strong>è®­ç»ƒæ•°æ®:</strong><br />
<img src="https://image.yayan.xyz/20240314194528.png" alt="" /></p>
<p><strong>æäº¤æ ·ä¾‹æ–‡ä»¶:</strong><br />
<img src="https://image.yayan.xyz/20240314190025.png" alt="" /></p>
<h2 id="3-æ€è·¯"><a class="markdownIt-Anchor" href="#3-æ€è·¯"></a> 3. æ€è·¯</h2>
<h3 id="candidate-generation"><a class="markdownIt-Anchor" href="#candidate-generation"></a> Candidate Generation</h3>
<p><a target="_blank" rel="noopener" href="https://www.kaggle.com/competitions/otto-recommender-system/discussion/364721">Candidate Generationæ–¹æ³•</a><br />
<img src="https://image.yayan.xyz/20240314194910.png" alt="" /><br />
åŸå› :åƒè¿™ä¸ªæ•°æ®é‡çš„æ•°æ®ç›´æ¥æ”¾åˆ°æ¨¡å‹é‡Œæ˜¯ä¸å¯èƒ½çš„äº‹,æ‰€ä»¥æŒ‰ç…§ä¸Šé¢çš„æµç¨‹ä¸€æ­¥æ­¥æ¥.</p>
<p><strong>Step 1 - Generate Candidates</strong><br />
ç”¨æ¥é€‰æ‹©å€™é€‰å•†å“çš„ä¸€äº›æ ‡å‡†ï¼š</p>
<ul>
<li>ä»¥å‰è´­ä¹°çš„ç‰©å“</li>
<li>å›è´­çš„ç‰©å“</li>
<li>æ€»ä½“ä¸Šæœ€å—æ¬¢è¿çš„é¡¹ç›®</li>
<li>åŸºäºæŸç§èšç±»æŠ€æœ¯çš„ç›¸ä¼¼é¡¹ç›®</li>
<li>åŸºäºå…±åŒè®¿é—®çŸ©é˜µç­‰ç±»ä¼¼é¡¹ç›®</li>
</ul>
<p><strong>Step 2 - ReRank and Choose 20</strong><br />
é€šè¿‡ä¸Šä¸€æ­¥,å•†å“ä¼šå°‘å¾ˆå¤š,ç„¶åå¯ä»¥æŒ‰ç…§ä¸€äº›è§„åˆ™æ¥é€‰æ‹©20ä¸ªå•†å“.</p>
<ul>
<li>Ranker Model</li>
<li>Handcrafted Rules</li>
</ul>
<h3 id="what-is-the-co-visitation-matrix-really"><a class="markdownIt-Anchor" href="#what-is-the-co-visitation-matrix-really"></a> What is the co-visitation matrix, really?</h3>
<p><a target="_blank" rel="noopener" href="https://www.kaggle.com/competitions/otto-recommender-system/discussion/365358">What is the co-visitation matrix, really?</a></p>
<p>It is very interesting to think of modern techniques in the context of their roots.</p>
<p>â€œRadek is a _â€.å½“æˆ‘ä»¬é¢„æµ‹æ¨ªçº¿ä¸Šçš„è¯çš„æ—¶å€™, ä¸‰å…ƒæ¨¡å‹ä¼šä»&quot;Radek&quot;, â€œisâ€, and â€œaâ€ çœ‹,ç„¶åç»Ÿè®¡å“ªä¸ªå•è¯å’Œç€ä¸‰ä¸ªå•è¯å‡ºç°çš„æ¬¡æ•°æœ€å¤š.</p>
<p>ä½†æ˜¯å¯èƒ½å¹¶æ²¡æœ‰é‚£ä¹ˆå¤šçš„&quot;Radek&quot;, â€œisâ€, and &quot;a&quot;çš„å‡ºç°è¿‡.<br />
æ‰€ä»¥è¿™å°±æ˜¯RNN(or word2vec)çš„å‡ºç°,ä»–ä»¬ä¼šçœ‹ â€œRadek was an _â€, &quot;Tommy is a __&quot;ä½œä¸ºä¾‹å­.</p>
<p>é‚£ä¹ˆï¼Œè¿™ä¸å…±è®¿çŸ©é˜µæœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ<br />
å…±è®¿é—®çŸ©é˜µç»Ÿè®¡ä¸¤ä¸ªåŠ¨ä½œåœ¨éå¸¸æ¥è¿‘çš„æƒ…å†µä¸‹çš„å…±å‡ºç°ã€‚<br />
å¦‚æœç”¨æˆ·è´­ä¹°äº†aï¼Œåœ¨è´­ä¹°Båä¸ä¹…ï¼Œæˆ‘ä»¬å°†è¿™äº›å€¼å­˜å‚¨åœ¨ä¸€èµ·ã€‚<br />
æˆ‘ä»¬è®¡ç®—è®¡æ•°ï¼Œå¹¶æ ¹æ®æœ€è¿‘çš„å†å²æ¥ä¼°è®¡æœªæ¥è¡ŒåŠ¨çš„æ¦‚ç‡ã€‚<br />
ç†è§£å…±åŒè®¿é—®çŸ©é˜µæ–¹æ³•ä¸­å‘ç”Ÿçš„äº‹æƒ…æ˜¯éå¸¸é‡è¦çš„â€¦</p>
<h3 id="candidate-rerank-model-lb-0575"><a class="markdownIt-Anchor" href="#candidate-rerank-model-lb-0575"></a> Candidate ReRank Model - [LB 0.575]</h3>
<p><a target="_blank" rel="noopener" href="https://www.kaggle.com/code/cdeotte/candidate-rerank-model-lb-0-575?scriptVersionId=111214204">Candidate ReRank Model - LB 0.575</a></p>
<p><strong>Step 1 - Generate Candidates</strong><br />
å¯¹æ¯ä¸€ä¸ªç”¨æˆ·ç”Ÿæˆå€™é€‰å•†å“,äº”ç§æ–¹æ³•:</p>
<ul>
<li>ç”¨æˆ·ç‚¹å‡»ã€è´­ç‰©è½¦ã€è®¢å•çš„ç”¨æˆ·å†å²è®°å½•</li>
<li>æµ‹è¯•æ•°æ®ä¸€å‘¨å†…æœ€å—æ¬¢è¿çš„20æ¬¡ç‚¹å‡»ã€è´­ç‰©è½¦ã€è®¢å•</li>
<li>ç‚¹å‡»/è´­ç‰©è½¦/è®¢å•åˆ°è´­ç‰©è½¦/è®¢å• çš„å…±åŒè®¿é—®çŸ©é˜µ(å¸¦æœ‰ç±»å‹æƒé‡)</li>
<li>ç§°ä¸ºbuy2buyçš„è´­ç‰©è½¦/è®¢å•åˆ°è´­ç‰©è½¦/è®¢å•çš„å…±è®¿é—®çŸ©é˜µ</li>
<li>ç‚¹å‡»/è´­ç‰©è½¦/è®¢å•ä¸ç‚¹å‡»çš„å…±è®¿é—®çŸ©é˜µï¼ˆå¸¦æ—¶é—´æƒé‡ï¼‰</li>
</ul>
<p><strong>Step 2 - ReRank and Choose 20</strong><br />
ä»ä¸Šé¢çš„å€™é€‰åˆ—è¡¨ä¸­é€‰æ‹©20ä¸ªä½œä¸ºæœ€ç»ˆé¢„æµ‹ç»“æœ,é€‰å–çš„é¡ºåºä¸º:</p>
<ul>
<li>æœ€è¿‘è®¿é—®è¿‡çš„é¡¹ç›®</li>
<li>ä»¥å‰å¤šæ¬¡è®¿é—®çš„é¡¹ç›®</li>
<li>ä»¥å‰åœ¨è´­ç‰©è½¦æˆ–è®¢å•ä¸­çš„é¡¹ç›®</li>
<li>è´­ç‰©è½¦/è®¢å•åˆ°è´­ç‰©è½¦/è®¢å•çš„å…±åŒè®¿é—®çŸ©é˜µ</li>
<li>å½“å‰çƒ­é—¨é¡¹ç›®</li>
</ul>
<h4 id="å€™é€‰å•†å“ç”Ÿæˆ"><a class="markdownIt-Anchor" href="#å€™é€‰å•†å“ç”Ÿæˆ"></a> å€™é€‰å•†å“ç”Ÿæˆ</h4>
<p>â€œCarts Ordersâ€ Co-visitation Matrix - Type Weighted</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">æ„å»ºæ€è·¯:</span></span><br><span class="line"><span class="string">æŒ‰ç…§ç”¨æˆ·å’Œæ—¶é—´è¿›è¡Œæ’åº</span></span><br><span class="line"><span class="string">df.groupby(&#x27;session&#x27;).cumcount()æ±‚å‡ºæ¯ä¸ªç”¨æˆ·çš„è¡Œæ•°</span></span><br><span class="line"><span class="string">ä¿ç•™æ¯ä¸ªç”¨æˆ·æœ€è¿‘çš„30ä¸ªè¡Œä¸º</span></span><br><span class="line"><span class="string">df.merge(df, on=&#x27;session&#x27;)åˆ›å»ºæ¯ä¸ªç”¨æˆ·çš„è¡Œä¸ºå¯¹å…¶ä»–è¡Œä¸ºçš„å…³ç³»(ç›®çš„æ˜¯æ„å»ºå•†å“å’Œå•†å“çš„å…³ç³»)</span></span><br><span class="line"><span class="string">ç­›é€‰å‡ºæ—¶é—´é—´éš”å°äº1å¤© ä¸”å•†å“ç¼–å·ä¸ç›¸åŒçš„è¡Œ,åˆ é™¤é‡å¤çš„å€¼</span></span><br><span class="line"><span class="string">æ ¹æ®è¡Œä¸ºçš„æƒé‡ç³»æ•°,å¯¹å•†å“ä¹‹é—´çš„å…³ç³»è¿›è¡Œèµ‹å€¼</span></span><br><span class="line"><span class="string">å¾—åˆ°äº†æ¯ä¸ªå•†å“ä¹‹é—´çš„æƒé‡ç³»æ•°</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line">type_weight = &#123;<span class="number">0</span>:<span class="number">1</span>, <span class="number">1</span>:<span class="number">6</span>, <span class="number">2</span>:<span class="number">3</span>&#125;</span><br><span class="line">df = df.sort_values([<span class="string">&#x27;session&#x27;</span>, <span class="string">&#x27;ts&#x27;</span>], ascending=[<span class="literal">True</span>, <span class="literal">False</span>])  <span class="comment"># æ ¹æ®&#x27;session&#x27;å’Œ&#x27;ts&#x27;æ’åºæ•°æ®æ¡†ï¼Œå…ˆå‡åºæ’&#x27;session&#x27;å†é™åºæ’&#x27;ts&#x27;</span></span><br><span class="line"><span class="comment"># ä½¿ç”¨SESSIONçš„TAIL</span></span><br><span class="line">df = df.reset_index(drop=<span class="literal">True</span>)  <span class="comment"># é‡è®¾ç´¢å¼•å¹¶åˆ é™¤åŸç´¢å¼•</span></span><br><span class="line">df[<span class="string">&#x27;n&#x27;</span>] = df.groupby(<span class="string">&#x27;session&#x27;</span>).cumcount()  <span class="comment"># å¯¹&#x27;session&#x27;è¿›è¡Œåˆ†ç»„è®¡æ•°</span></span><br><span class="line">df = df.loc[df.n &lt; <span class="number">30</span>].drop(<span class="string">&#x27;n&#x27;</span>, axis=<span class="number">1</span>)  <span class="comment"># ä¿ç•™æ¯ä¸ª&#x27;session&#x27;ç»„çš„å‰30è¡Œï¼Œç„¶ååˆ é™¤è®¡æ•°åˆ—&#x27;n&#x27;</span></span><br><span class="line"><span class="comment"># åˆ›å»ºå¯¹å…³ç³»</span></span><br><span class="line">df = df.merge(df, on=<span class="string">&#x27;session&#x27;</span>)  <span class="comment"># åœ¨&#x27;session&#x27;åˆ—ä¸Šåˆå¹¶æ•°æ®æ¡†è‡ªèº«ï¼Œåˆ›å»ºå¯¹å…³ç³»</span></span><br><span class="line">df = df.loc[((df.ts_x - df.ts_y).<span class="built_in">abs</span>() &lt; <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span>) &amp; (df.aid_x != df.aid_y)]  <span class="comment"># é€‰æ‹©æ—¶é—´é—´éš”å°äº1å¤©ä¸”&#x27;aid_x&#x27;ä¸ç­‰äº&#x27;aid_y&#x27;çš„è¡Œ</span></span><br><span class="line"><span class="comment"># å†…å­˜ç®¡ç†ï¼Œåˆ†éƒ¨è®¡ç®—</span></span><br><span class="line">df = df.loc[(df.aid_x &gt;= PART*SIZE) &amp; (df.aid_x &lt; (PART+<span class="number">1</span>)*SIZE)]  <span class="comment"># æ ¹æ®&#x27;aid_x&#x27;å€¼è¿›è¡Œåˆ†å—å¤„ç†</span></span><br><span class="line"><span class="comment"># åˆ†é…æƒé‡</span></span><br><span class="line">df = df[[<span class="string">&#x27;session&#x27;</span>, <span class="string">&#x27;aid_x&#x27;</span>, <span class="string">&#x27;aid_y&#x27;</span>, <span class="string">&#x27;type_y&#x27;</span>]].drop_duplicates([<span class="string">&#x27;session&#x27;</span>, <span class="string">&#x27;aid_x&#x27;</span>, <span class="string">&#x27;aid_y&#x27;</span>])  <span class="comment"># æ ¹æ®æŒ‡å®šåˆ—å»é™¤é‡å¤è¡Œï¼Œé€‰æ‹©æŒ‡å®šåˆ—</span></span><br><span class="line">df[<span class="string">&#x27;wgt&#x27;</span>] = df.type_y.<span class="built_in">map</span>(type_weight)  <span class="comment"># æ ¹æ®&#x27;type_y&#x27;æ˜ å°„æƒé‡å€¼åˆ°&#x27;wgt&#x27;åˆ—</span></span><br><span class="line">df = df[[<span class="string">&#x27;aid_x&#x27;</span>, <span class="string">&#x27;aid_y&#x27;</span>, <span class="string">&#x27;wgt&#x27;</span>]]  <span class="comment"># ä¿ç•™&#x27;aid_x&#x27;, &#x27;aid_y&#x27;, &#x27;wgt&#x27;ä¸‰åˆ—</span></span><br><span class="line">df.wgt = df.wgt.astype(<span class="string">&#x27;float32&#x27;</span>)  <span class="comment"># å°†&#x27;wgt&#x27;åˆ—è½¬æ¢ä¸ºfloat32ç±»å‹</span></span><br><span class="line">df = df.groupby([<span class="string">&#x27;aid_x&#x27;</span>, <span class="string">&#x27;aid_y&#x27;</span>]).wgt.<span class="built_in">sum</span>()  <span class="comment"># æ ¹æ®&#x27;aid_x&#x27;, &#x27;aid_y&#x27;åˆ†ç»„ï¼Œå¹¶æ±‚&#x27;wgt&#x27;åˆ—çš„å’Œ</span></span><br></pre></td></tr></table></figure>
<p>â€œBuy2Buyâ€ Co-visitation Matrix</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">æ„å»ºæ€è·¯:</span></span><br><span class="line"><span class="string">æŒ‰ç…§ç”¨æˆ·å’Œæ—¶é—´è¿›è¡Œæ’åº</span></span><br><span class="line"><span class="string">df.groupby(&#x27;session&#x27;).cumcount()æ±‚å‡ºæ¯ä¸ªç”¨æˆ·çš„è¡Œæ•°</span></span><br><span class="line"><span class="string">ä¿ç•™æ¯ä¸ªç”¨æˆ·æœ€è¿‘çš„30ä¸ªè¡Œä¸º</span></span><br><span class="line"><span class="string">df.merge(df, on=&#x27;session&#x27;)åˆ›å»ºæ¯ä¸ªç”¨æˆ·çš„è¡Œä¸ºå¯¹å…¶ä»–è¡Œä¸ºçš„å…³ç³»(ç›®çš„æ˜¯æ„å»ºå•†å“å’Œå•†å“çš„å…³ç³»)</span></span><br><span class="line"><span class="string">ç­›é€‰å‡ºæ—¶é—´é—´éš”å°äº14å¤© ä¸”å•†å“ç¼–å·ä¸ç›¸åŒçš„è¡Œ,åˆ é™¤é‡å¤çš„å€¼</span></span><br><span class="line"><span class="string">æƒé‡å…¨éƒ¨æ˜¯1(åŠ è´­å’ŒåŠ è´­ä¹‹é—´çš„å…³ç³»),å¯¹å•†å“å’Œå•†å“ä¹‹é—´çš„å…³ç³»è¿›è¡Œåˆ†ç»„æ±‚å’Œ</span></span><br><span class="line"><span class="string">å¾—åˆ°äº†æ¯ä¸ªå•†å“ä¹‹é—´çš„æƒé‡ç³»æ•°</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line">df = df.loc[df[<span class="string">&#x27;type&#x27;</span>].isin([<span class="number">1</span>,<span class="number">2</span>])] <span class="comment"># ä»…ä¿ç•™è´­ç‰©è½¦å’Œè®¢å•</span></span><br><span class="line">df = df.sort_values([<span class="string">&#x27;session&#x27;</span>,<span class="string">&#x27;ts&#x27;</span>],ascending=[<span class="literal">True</span>,<span class="literal">False</span>]) <span class="comment"># æŒ‰&#x27;session&#x27;å’Œ&#x27;ts&#x27;é™åºæ’åº</span></span><br><span class="line"><span class="comment"># ä½¿ç”¨SESSIONçš„TAIL</span></span><br><span class="line">df = df.reset_index(drop=<span class="literal">True</span>) <span class="comment"># é‡æ–°è®¾ç½®ç´¢å¼•å¹¶ä¸¢å¼ƒåŸç´¢å¼•</span></span><br><span class="line">df[<span class="string">&#x27;n&#x27;</span>] = df.groupby(<span class="string">&#x27;session&#x27;</span>).cumcount() <span class="comment"># è®¡ç®—æ¯ä¸ª&#x27;session&#x27;ç»„çš„è¡Œæ•°</span></span><br><span class="line"><span class="comment"># ä¿ç•™ç”¨æˆ·æœ€è¿‘çš„30ä¸ªè¡Œä¸º</span></span><br><span class="line">df = df.loc[df.n&lt;<span class="number">30</span>].drop(<span class="string">&#x27;n&#x27;</span>,axis=<span class="number">1</span>) <span class="comment"># ä»…ä¿ç•™æ¯ä¸ª&#x27;session&#x27;ç»„çš„å‰30è¡Œï¼Œå¹¶åˆ é™¤&#x27;n&#x27;åˆ—</span></span><br><span class="line"><span class="comment"># åˆ›å»ºæˆå¯¹å…³ç³»</span></span><br><span class="line">df = df.merge(df, on=<span class="string">&#x27;session&#x27;</span>) <span class="comment"># åœ¨&#x27;session&#x27;ä¸Šåˆå¹¶æ•°æ®æ¡†è‡ªèº«ï¼Œåˆ›å»ºæˆå¯¹å…³ç³»</span></span><br><span class="line">df = df.loc[((df.ts_x - df.ts_y).<span class="built_in">abs</span>() &lt; <span class="number">14</span> * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span>) &amp; (df.aid_x != df.aid_y)] <span class="comment"># ç­›é€‰å‡ºæ—¶é—´é—´éš”å°äº14å¤©ä¸”&#x27;aid_x&#x27;ä¸ç­‰äº&#x27;aid_y&#x27;çš„è¡Œ</span></span><br><span class="line"><span class="comment"># å†…å­˜ç®¡ç†ï¼Œåˆ†éƒ¨è®¡ç®—</span></span><br><span class="line">df = df.loc[(df.aid_x &gt;= PART*SIZE) &amp; (df.aid_x &lt; (PART+<span class="number">1</span>)*SIZE)] <span class="comment"># æ ¹æ®&#x27;aid_x&#x27;çš„å€¼å¯¹æ•°æ®æ¡†è¿›è¡Œåˆ†å—å¤„ç†</span></span><br><span class="line"><span class="comment"># åˆ†é…æƒé‡</span></span><br><span class="line">df = df[[<span class="string">&#x27;session&#x27;</span>, <span class="string">&#x27;aid_x&#x27;</span>, <span class="string">&#x27;aid_y&#x27;</span>, <span class="string">&#x27;type_y&#x27;</span>]].drop_duplicates([<span class="string">&#x27;session&#x27;</span>, <span class="string">&#x27;aid_x&#x27;</span>, <span class="string">&#x27;aid_y&#x27;</span>]) <span class="comment"># æ ¹æ®&#x27;session&#x27;, &#x27;aid_x&#x27;, &#x27;aid_y&#x27;åˆ—å»é™¤é‡å¤è¡Œï¼Œå¹¶é€‰æ‹©æŒ‡å®šåˆ—</span></span><br><span class="line">df[<span class="string">&#x27;wgt&#x27;</span>] = <span class="number">1</span> <span class="comment"># æ·»åŠ &#x27;wgt&#x27;åˆ—ï¼Œå¹¶èµ‹å€¼ä¸º1</span></span><br><span class="line">df = df[[<span class="string">&#x27;aid_x&#x27;</span>, <span class="string">&#x27;aid_y&#x27;</span>, <span class="string">&#x27;wgt&#x27;</span>]] <span class="comment"># ä»…ä¿ç•™&#x27;aid_x&#x27;, &#x27;aid_y&#x27;, &#x27;wgt&#x27;ä¸‰åˆ—</span></span><br><span class="line">df.wgt = df.wgt.astype(<span class="string">&#x27;float32&#x27;</span>) <span class="comment"># å°†&#x27;wgt&#x27;åˆ—çš„æ•°æ®ç±»å‹è½¬æ¢ä¸ºfloat32</span></span><br><span class="line">df = df.groupby([<span class="string">&#x27;aid_x&#x27;</span>, <span class="string">&#x27;aid_y&#x27;</span>]).wgt.<span class="built_in">sum</span>() <span class="comment"># æ ¹æ®&#x27;aid_x&#x27;, &#x27;aid_y&#x27;åˆ†ç»„ï¼Œå¹¶å¯¹&#x27;wgt&#x27;åˆ—æ±‚å’Œ</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>â€œClicksâ€ Co-visitation Matrix - Time Weighted</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">æ„å»ºæ€è·¯:</span></span><br><span class="line"><span class="string">æŒ‰ç…§ç”¨æˆ·å’Œæ—¶é—´è¿›è¡Œæ’åº</span></span><br><span class="line"><span class="string">df.groupby(&#x27;session&#x27;).cumcount()æ±‚å‡ºæ¯ä¸ªç”¨æˆ·çš„è¡Œæ•°</span></span><br><span class="line"><span class="string">ä¿ç•™æ¯ä¸ªç”¨æˆ·æœ€è¿‘çš„30ä¸ªè¡Œä¸º</span></span><br><span class="line"><span class="string">df.merge(df, on=&#x27;session&#x27;)åˆ›å»ºæ¯ä¸ªç”¨æˆ·çš„è¡Œä¸ºå¯¹å…¶ä»–è¡Œä¸ºçš„å…³ç³»(ç›®çš„æ˜¯æ„å»ºå•†å“å’Œå•†å“çš„å…³ç³»)</span></span><br><span class="line"><span class="string">ç­›é€‰å‡ºæ—¶é—´é—´éš”å°äº1å¤© ä¸”å•†å“ç¼–å·ä¸ç›¸åŒçš„è¡Œ,åˆ é™¤é‡å¤çš„å€¼</span></span><br><span class="line"><span class="string">æŒ‰æ—¶é—´é¡ºåºå¯¹å•†å“å’Œå•†å“ä¹‹é—´çš„å…³ç³»è¿›è¡Œèµ‹å€¼,æ—¶é—´è¶Šè¿‘æƒé‡è¶Šå¤§</span></span><br><span class="line"><span class="string">å¾—åˆ°äº†æ¯ä¸ªå•†å“ä¹‹é—´çš„æƒé‡ç³»æ•°</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line">df = df.sort_values([<span class="string">&#x27;session&#x27;</span>, <span class="string">&#x27;ts&#x27;</span>], ascending=[<span class="literal">True</span>, <span class="literal">False</span>])  <span class="comment"># æŒ‰&#x27;session&#x27;å’Œ&#x27;ts&#x27;æ’åºï¼Œ&#x27;session&#x27;å‡åºï¼Œ&#x27;ts&#x27;é™åº</span></span><br><span class="line"><span class="comment"># ä½¿ç”¨SESSIONçš„TAIL</span></span><br><span class="line">df = df.reset_index(drop=<span class="literal">True</span>)  <span class="comment"># é‡ç½®ç´¢å¼•å¹¶åˆ é™¤æ—§ç´¢å¼•</span></span><br><span class="line">df[<span class="string">&#x27;n&#x27;</span>] = df.groupby(<span class="string">&#x27;session&#x27;</span>).cumcount()  <span class="comment"># å¯¹&#x27;session&#x27;è¿›è¡Œè®¡æ•°</span></span><br><span class="line">df = df.loc[df.n &lt; <span class="number">30</span>].drop(<span class="string">&#x27;n&#x27;</span>, axis=<span class="number">1</span>)  <span class="comment"># ä¿ç•™æ¯ä¸ª&#x27;session&#x27;ç»„çš„å‰30è¡Œï¼Œç„¶ååˆ é™¤è®¡æ•°åˆ—</span></span><br><span class="line"><span class="comment"># åˆ›å»ºå¯¹å…³ç³»</span></span><br><span class="line">df = df.merge(df, on=<span class="string">&#x27;session&#x27;</span>)  <span class="comment"># åœ¨&#x27;session&#x27;ä¸Šåˆå¹¶æ•°æ®æ¡†è‡ªèº«ï¼Œåˆ›å»ºå¯¹å…³ç³»</span></span><br><span class="line">df = df.loc[((df.ts_x - df.ts_y).<span class="built_in">abs</span>() &lt; <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span>) &amp; (df.aid_x != df.aid_y)]  <span class="comment"># é€‰æ‹©æ—¶é—´é—´éš”å°äº1å¤©ä¸”&#x27;aid_x&#x27;ä¸ç­‰äº&#x27;aid_y&#x27;çš„è¡Œ</span></span><br><span class="line"><span class="comment"># å†…å­˜ç®¡ç†ï¼Œåˆ†éƒ¨è®¡ç®—</span></span><br><span class="line">df = df.loc[(df.aid_x &gt;= PART*SIZE) &amp; (df.aid_x &lt; (PART+<span class="number">1</span>)*SIZE)]  <span class="comment"># æ ¹æ®&#x27;aid_x&#x27;çš„å€¼å¯¹æ•°æ®æ¡†è¿›è¡Œåˆ†å—å¤„ç†</span></span><br><span class="line"><span class="comment"># åˆ†é…æƒé‡</span></span><br><span class="line">df = df[[<span class="string">&#x27;session&#x27;</span>, <span class="string">&#x27;aid_x&#x27;</span>, <span class="string">&#x27;aid_y&#x27;</span>, <span class="string">&#x27;ts_x&#x27;</span>]].drop_duplicates([<span class="string">&#x27;session&#x27;</span>, <span class="string">&#x27;aid_x&#x27;</span>, <span class="string">&#x27;aid_y&#x27;</span>])  <span class="comment"># æ ¹æ®æŒ‡å®šåˆ—å»é™¤é‡å¤è¡Œ</span></span><br><span class="line">df[<span class="string">&#x27;wgt&#x27;</span>] = <span class="number">1</span> + <span class="number">3</span>*(df.ts_x - <span class="number">1659304800</span>) / (<span class="number">1662328791</span> - <span class="number">1659304800</span>)  <span class="comment"># æ ¹æ®å…¬å¼è®¡ç®—æƒé‡</span></span><br><span class="line">df = df[[<span class="string">&#x27;aid_x&#x27;</span>, <span class="string">&#x27;aid_y&#x27;</span>, <span class="string">&#x27;wgt&#x27;</span>]]  <span class="comment"># ä¿ç•™&#x27;aid_x&#x27;, &#x27;aid_y&#x27;, &#x27;wgt&#x27;ä¸‰åˆ—</span></span><br><span class="line">df.wgt = df.wgt.astype(<span class="string">&#x27;float32&#x27;</span>)  <span class="comment"># å°†&#x27;wgt&#x27;åˆ—çš„æ•°æ®ç±»å‹è½¬æ¢ä¸ºfloat32</span></span><br><span class="line">df = df.groupby([<span class="string">&#x27;aid_x&#x27;</span>, <span class="string">&#x27;aid_y&#x27;</span>]).wgt.<span class="built_in">sum</span>()  <span class="comment"># æ ¹æ®&#x27;aid_x&#x27;, &#x27;aid_y&#x27;åˆ†ç»„ï¼Œå¹¶å¯¹&#x27;wgt&#x27;åˆ—æ±‚å’Œ</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å•†å“çš„çŸ©é˜µæ„å»ºå®Œæˆä¹‹åéƒ½ç»å†ä¸‹é¢çš„æ­¥éª¤</span></span><br><span class="line">tmp = tmp.reset_index()</span><br><span class="line"><span class="comment"># æŒ‰ç…§æƒé‡è¿›è¡Œæ’åº</span></span><br><span class="line">tmp = tmp.sort_values([<span class="string">&#x27;aid_x&#x27;</span>,<span class="string">&#x27;wgt&#x27;</span>],ascending=[<span class="literal">True</span>,<span class="literal">False</span>])</span><br><span class="line">tmp = tmp.reset_index(drop=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># ä¿ç•™æ¯ä¸ªå•†å“çš„å‰15(ä¸å®š)ä¸ªå…³ç³»</span></span><br><span class="line">tmp[<span class="string">&#x27;n&#x27;</span>] = tmp.groupby(<span class="string">&#x27;aid_x&#x27;</span>).aid_y.cumcount()</span><br><span class="line">tmp = tmp.loc[tmp.n&lt;<span class="number">15</span>].drop(<span class="string">&#x27;n&#x27;</span>,axis=<span class="number">1</span>)</span><br><span class="line">tmp.groupby(<span class="string">&#x27;aid_x&#x27;</span>).aid_y.apply(<span class="built_in">list</span>).to_dict()</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">æ€»ç»“:</span></span><br><span class="line"><span class="string">1. &quot;Carts Orders&quot; Co-visitation Matrix - Type Weighted</span></span><br><span class="line"><span class="string">å«ä¹‰:æ ¹æ®ç”¨æˆ·çš„å†å²è¡Œä¸ºåˆ†é…å•†å“ä¹‹é—´çš„æƒé‡ç³»æ•°å¯¹åº”top_20_buys</span></span><br><span class="line"><span class="string">2. &quot;Buy2Buy&quot; Co-visitation Matrix</span></span><br><span class="line"><span class="string">å«ä¹‰:æ ¹æ®ç”¨æˆ·çš„åŠ è´­å’Œè´­ä¹°è¡Œä¸ºåˆ†é…å•†å“ä¹‹é—´çš„æƒé‡ç³»æ•°å¯¹åº”top_20_buy2buy</span></span><br><span class="line"><span class="string">3. &quot;Clicks&quot; Co-visitation Matrix - Time Weighted</span></span><br><span class="line"><span class="string">å«ä¹‰:æ ¹æ®ç”¨æˆ·çš„è¡Œä¸ºæ—¶é—´åˆ†é…å•†å“ä¹‹é—´çš„æƒé‡ç³»æ•°å¯¹åº”top_20_clicks</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<h4 id="é‡æ’åä¸æœ€ç»ˆé€‰æ‹©"><a class="markdownIt-Anchor" href="#é‡æ’åä¸æœ€ç»ˆé€‰æ‹©"></a> é‡æ’åä¸æœ€ç»ˆé€‰æ‹©</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">type_weight_multipliers = &#123;<span class="number">0</span>: <span class="number">1</span>, <span class="number">1</span>: <span class="number">6</span>, <span class="number">2</span>: <span class="number">3</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">suggest_clicks</span>(<span class="params">df</span>):</span><br><span class="line">   <span class="comment"># USER HISTORY AIDS AND TYPES</span></span><br><span class="line">   aids = df.aid.tolist()  <span class="comment"># è·å–ç”¨æˆ·å†å²å•†å“id</span></span><br><span class="line">   ty = df.<span class="built_in">type</span>.tolist()  <span class="comment"># è·å–ç”¨æˆ·å†å²è¡Œä¸º</span></span><br><span class="line">   unique_aids = <span class="built_in">list</span>(<span class="built_in">dict</span>.fromkeys(aids[::-<span class="number">1</span>]))  <span class="comment"># è·å–ä¸é‡å¤çš„å•†å“id</span></span><br><span class="line">   <span class="comment"># å¦‚æœå†å²å•†å“idå¤§äºç­‰äº20ä¸ª,åˆ™è¿”å›å‰20ä¸ªå•†å“id</span></span><br><span class="line">   <span class="keyword">if</span> <span class="built_in">len</span>(unique_aids) &gt;= <span class="number">20</span>:</span><br><span class="line">       <span class="comment"># æ ¹æ®å•†å“idå‡ºç°çš„æ—¶é—´,å¯¹å•†å“idè¿›è¡Œæ’åº</span></span><br><span class="line">       weights = np.logspace(<span class="number">0.1</span>, <span class="number">1</span>, <span class="built_in">len</span>(aids), base=<span class="number">2</span>, endpoint=<span class="literal">True</span>) - <span class="number">1</span></span><br><span class="line">       <span class="comment"># è®°å½•å•†å“id:æƒé‡</span></span><br><span class="line">       aids_temp = Counter() </span><br><span class="line">       <span class="comment"># å•†å“,æƒé‡,ç±»å‹</span></span><br><span class="line">       <span class="keyword">for</span> aid, w, t <span class="keyword">in</span> <span class="built_in">zip</span>(aids, weights, ty): </span><br><span class="line">           <span class="comment"># idæƒé‡=æ—¶é—´æƒé‡*ç±»å‹æƒé‡</span></span><br><span class="line">           aids_temp[aid] += w * type_weight_multipliers[t]</span><br><span class="line">        <span class="comment"># è¿”å›æƒé‡æœ€å¤§çš„å‰20ä¸ªå•†å“id</span></span><br><span class="line">       sorted_aids = [k <span class="keyword">for</span> k,v <span class="keyword">in</span> aids_temp.most_common(<span class="number">20</span>)]</span><br><span class="line">       <span class="keyword">return</span> sorted_aids</span><br><span class="line">   <span class="comment"># å¦‚æœä¸å¤Ÿ20ä¸ª, ä»ç‚¹å‡»æœ€é«˜çš„å•†å“å…³ç³»ä¸­æ‰¾åˆ°æœ€è¿‘ç‚¹å‡»çš„å•†å“ ç„¶åå–å‡ºæœ€å…³è”çš„20ä¸ªå•†å“</span></span><br><span class="line">   aids2 = <span class="built_in">list</span>(itertools.chain(*[top_20_clicks[aid] <span class="keyword">for</span> aid <span class="keyword">in</span> unique_aids <span class="keyword">if</span> aid <span class="keyword">in</span> top_20_click]))</span><br><span class="line">   <span class="comment"># ä»æœ€è¿‘ç‚¹å‡»çš„å•†å“çš„æœ€å…³è”çš„å•†å“ä¸­æ‰¾æ‰“å‡ºç°æ¬¡æ•°æœ€å¤šçš„å•†å“</span></span><br><span class="line">   top_aids2 = [aid2 <span class="keyword">for</span> aid2, cnt <span class="keyword">in</span> Counter(aids2).most_common(<span class="number">20</span>) <span class="keyword">if</span> aid2 <span class="keyword">not</span> <span class="keyword">in</span> unique_aids]</span><br><span class="line">   <span class="comment"># å°†è¿™äº›å•†å“å’Œç”¨æˆ·å†å²å•†å“åˆå¹¶</span></span><br><span class="line">   result = unique_aids + top_aids2[:<span class="number">20</span> - <span class="built_in">len</span>(unique_aids)]</span><br><span class="line">   <span class="comment"># å¦‚æœå†å²å•†å“åŠ ä¸Šæœ€å…³è”çš„å•†å“è¿˜ä¸å¤Ÿ20ä¸ª,åˆ™ä»testä¸­çš„å†å²æ•°æ®ä¸­æ‰¾åˆ°ç‚¹å‡»æœ€é«˜çš„å•†å“</span></span><br><span class="line">   <span class="keyword">return</span> result + <span class="built_in">list</span>(top_clicks)[:<span class="number">20</span> - <span class="built_in">len</span>(result)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">suggest_buys</span>(<span class="params">df</span>):</span><br><span class="line">   <span class="comment"># USER HISTORY AIDS AND TYPES</span></span><br><span class="line">   aids = df.aid.tolist()  <span class="comment"># è·å–ç”¨æˆ·å†å²å•†å“id</span></span><br><span class="line">   ty = df.<span class="built_in">type</span>.tolist()  <span class="comment"># è·å–ç”¨æˆ·å†å²è¡Œä¸º</span></span><br><span class="line">   unique_aids = <span class="built_in">list</span>(<span class="built_in">dict</span>.fromkeys(aids[::-<span class="number">1</span>]))  <span class="comment"># è·å–æ‰€æœ‰è¡Œä¸ºä¸é‡å¤çš„å•†å“id</span></span><br><span class="line">   <span class="comment"># åªä¿ç•™ç”¨æˆ·å†å²åŠ è´­å’Œè´­ä¹°çš„è¡Œä¸º(å•†å“id)</span></span><br><span class="line">   df = df.loc[(df[<span class="string">&#x27;type&#x27;</span>] == <span class="number">1</span>) | (df[<span class="string">&#x27;type&#x27;</span>] == <span class="number">2</span>)]  </span><br><span class="line">   <span class="comment"># è·å–åŠ è´­å’Œè´­ä¹°çš„ä¸é‡å¤å•†å“id</span></span><br><span class="line">   unique_buys = <span class="built_in">list</span>(<span class="built_in">dict</span>.fromkeys(df.aid.tolist()[::-<span class="number">1</span>]))  </span><br><span class="line">   <span class="comment"># å¦‚æœå†å²è¡Œä¸ºå•†å“idå¤§äºç­‰äº20ä¸ª,åˆ™æ ¹æ®å†å²è¡Œä¸ºè¿”å›å•†å“id</span></span><br><span class="line">   <span class="keyword">if</span> <span class="built_in">len</span>(unique_aids) &gt;= <span class="number">20</span>:</span><br><span class="line">       <span class="comment"># æ—¶é—´æƒé‡</span></span><br><span class="line">       weights = np.logspace(<span class="number">0.5</span>, <span class="number">1</span>, <span class="built_in">len</span>(aids), base=<span class="number">2</span>, endpoint=<span class="literal">True</span>) - <span class="number">1</span> </span><br><span class="line">       aids_temp = Counter() </span><br><span class="line">       <span class="comment"># idæƒé‡=æ—¶é—´æƒé‡*ç±»å‹æƒé‡</span></span><br><span class="line">       <span class="keyword">for</span> aid, w, t <span class="keyword">in</span> <span class="built_in">zip</span>(aids, weights, types): </span><br><span class="line">           aids_temp[aid] += w * type_weight_multipliers[t] </span><br><span class="line">       <span class="comment"># æ‰¾åˆ°ä¸ç”¨æˆ·å†å²è´­ä¹°/åŠ è´­è¡Œä¸ºæœ€ç›¸å…³çš„20ä¸ªå•†å“id</span></span><br><span class="line">       aids3 = <span class="built_in">list</span>(itertools.chain(*[top_20_buy2buy[aid] <span class="keyword">for</span> aid <span class="keyword">in</span> unique_buys <span class="keyword">if</span> aid <span class="keyword">in</span> top_20_buy2buy]))  </span><br><span class="line">       <span class="comment"># å¯¹è¿™äº›å•†å“idçš„æƒé‡å¢åŠ 0.1</span></span><br><span class="line">       <span class="keyword">for</span> aid <span class="keyword">in</span> aids3: aids_temp[aid] += <span class="number">0.1</span></span><br><span class="line">       <span class="comment"># è¿”å›æƒé‡æœ€å¤§çš„å‰20ä¸ªå•†å“id</span></span><br><span class="line">       sorted_aids = [k <span class="keyword">for</span> k, v <span class="keyword">in</span> aids_temp.most_common(<span class="number">20</span>)]</span><br><span class="line">       <span class="keyword">return</span> sorted_aids</span><br><span class="line">   <span class="comment"># æ‰¾åˆ°ä¸ç”¨æˆ·å†å²æ‰€æœ‰è¡Œä¸ºçš„å•†å“è¡Œä¸ºä¸Šæœ€ç›¸å…³çš„20ä¸ªå•†å“id</span></span><br><span class="line">   aids2 = <span class="built_in">list</span>(itertools.chain(*[top_20_buys[aid] <span class="keyword">for</span> aid <span class="keyword">in</span> unique_aids <span class="keyword">if</span> aid <span class="keyword">in</span> top_20_buys]))  </span><br><span class="line">   <span class="comment"># æ‰¾åˆ°ä¸ç”¨æˆ·å†å²è´­ä¹°/åŠ è´­è¡Œä¸ºçš„å•†å“æœ€ç›¸å…³çš„20ä¸ªå•†å“id</span></span><br><span class="line">   aids3 = <span class="built_in">list</span>(itertools.chain(*[top_20_buy2buy[aid] <span class="keyword">for</span> aid <span class="keyword">in</span> unique_buys <span class="keyword">if</span> aid <span class="keyword">in</span> top_20_buy2buy]))  </span><br><span class="line">   <span class="comment"># å¯¹è¿™äº›å•†å“å‡ºç°çš„æ¬¡æ•°è¿›è¡Œç»Ÿè®¡</span></span><br><span class="line">   top_aids2 = [aid2 <span class="keyword">for</span> aid2, cnt <span class="keyword">in</span> Counter(aids2 + aids3).most_common(<span class="number">20</span>) <span class="keyword">if</span> aid2 <span class="keyword">not</span> <span class="keyword">in</span> unique_aids]  </span><br><span class="line">    <span class="comment"># è·å–æœ€ç»ˆç»“æœ,å†å²è¡Œä¸ºå•†å“id+æœ€ç›¸å…³çš„å•†å“id</span></span><br><span class="line">   result = unique_aids + top_aids2[:<span class="number">20</span> - <span class="built_in">len</span>(unique_aids)] </span><br><span class="line">   <span class="comment"># å¦‚æœè¿™äº›å•†å“è¿˜ä¸å¤Ÿ20ä¸ª,åˆ™ä»testä¸­çš„å†å²æ•°æ®ä¸­æ‰¾åˆ°è´­ä¹°æœ€é«˜çš„å•†å“</span></span><br><span class="line">   <span class="keyword">return</span> result + <span class="built_in">list</span>(top_orders)[:<span class="number">20</span> - <span class="built_in">len</span>(result)]  </span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç”Ÿæˆé¢„æµ‹ç»“æœ</span></span><br><span class="line">pred_df_clicks = test_df.sort_values([<span class="string">&quot;session&quot;</span>, <span class="string">&quot;ts&quot;</span>]).groupby([<span class="string">&quot;session&quot;</span>]).apply(</span><br><span class="line">    <span class="keyword">lambda</span> x: suggest_clicks(x)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">pred_df_buys = test_df.sort_values([<span class="string">&quot;session&quot;</span>, <span class="string">&quot;ts&quot;</span>]).groupby([<span class="string">&quot;session&quot;</span>]).apply(</span><br><span class="line">    <span class="keyword">lambda</span> x: suggest_buys(x)</span><br><span class="line">)</span><br><span class="line">clicks_pred_df = pd.DataFrame(pred_df_clicks.add_suffix(<span class="string">&quot;_clicks&quot;</span>), columns=[<span class="string">&quot;labels&quot;</span>]).reset_index()</span><br><span class="line">orders_pred_df = pd.DataFrame(pred_df_buys.add_suffix(<span class="string">&quot;_orders&quot;</span>), columns=[<span class="string">&quot;labels&quot;</span>]).reset_index()</span><br><span class="line">carts_pred_df = pd.DataFrame(pred_df_buys.add_suffix(<span class="string">&quot;_carts&quot;</span>), columns=[<span class="string">&quot;labels&quot;</span>]).reset_index()</span><br><span class="line">pred_df = pd.concat([clicks_pred_df, orders_pred_df, carts_pred_df])</span><br><span class="line">pred_df.columns = [<span class="string">&quot;session_type&quot;</span>, <span class="string">&quot;labels&quot;</span>]</span><br><span class="line">pred_df[<span class="string">&quot;labels&quot;</span>] = pred_df.labels.apply(<span class="keyword">lambda</span> x: <span class="string">&quot; &quot;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>,x)))</span><br><span class="line">pred_df.to_csv(<span class="string">&quot;submission.csv&quot;</span>, index=<span class="literal">False</span>)</span><br><span class="line">pred_df.head()</span><br></pre></td></tr></table></figure>
<h3 id="co-visitation-matrix"><a class="markdownIt-Anchor" href="#co-visitation-matrix"></a> Co-visitation Matrix</h3>
<p><a target="_blank" rel="noopener" href="https://www.kaggle.com/code/vslaykovsky/co-visitation-matrix">Co-visitation Matrix</a></p>
<p><strong>Step 1 - Generate Candidates</strong></p>
<ul>
<li>æ€»ä¼šæœ‰ä¸€äº›å•†å“æ˜¯ç»å¸¸ç‚¹å‡»çš„å¹¶ä¸”ä¸€èµ·ä¹°,åˆ©ç”¨è¿™ä¸ªæ€æƒ³æ„å»ºä¸€ä¸ªååŒçŸ©é˜µ</li>
<li>
<ul>
<li>é¦–å…ˆï¼Œæˆ‘ä»¬æŸ¥çœ‹åŒä¸€ä¼šè¯ä¸­åœ¨æ—¶é—´ä¸Šå½¼æ­¤æ¥è¿‘ï¼ˆ&lt;1å¤©ï¼‰çš„æ‰€æœ‰äº‹ä»¶å¯¹ã€‚æˆ‘ä»¬è®¡ç®—å…±åŒè®¿é—®çŸ©é˜µ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>M</mi><mrow><mi>a</mi><mi>i</mi><mi>d</mi><mn>1</mn><mtext>ï¼Œ</mtext><mi>a</mi><mi>i</mi><mi>d</mi><mn>2</mn></mrow></msub></mrow><annotation encoding="application/x-tex">M_{aid1ï¼Œaid2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">d</span><span class="mord mtight">1</span><span class="mord cjk_fallback mtight">ï¼Œ</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">d</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>é€šè¿‡å¯¹æ‰€æœ‰ä¼šè¯ä¸­çš„æ¯å¯¹äº‹ä»¶å¯¹çš„å…¨å±€æ•°é‡è¿›è¡Œè®¡æ•°ã€‚</li>
</ul>
</li>
<li>
<ul>
<li>å¯¹äºæ¯ä¸ªå•†å“id,æˆ‘ä»¬å‘ç°å‰20ä¸ªæœ€é¢‘ç¹çš„<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>i</mi><mi>d</mi><mn>2</mn><mo>=</mo><mi>a</mi><mi>r</mi><mi>g</mi><mi>s</mi><mi>o</mi><mi>r</mi><mi>t</mi><mtext>ï¼ˆ</mtext><mi>M</mi><mo stretchy="false">[</mo><mi>a</mi><mi>i</mi><mi>d</mi><mo stretchy="false">]</mo><mtext>ï¼‰</mtext><mo stretchy="false">[</mo><mo>âˆ’</mo><mn>20</mn><mo>:</mo><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">aid2=argsortï¼ˆM[aid]ï¼‰[-20:]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal">a</span><span class="mord mathnormal">i</span><span class="mord mathnormal">d</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">s</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">t</span><span class="mord cjk_fallback">ï¼ˆ</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mopen">[</span><span class="mord mathnormal">a</span><span class="mord mathnormal">i</span><span class="mord mathnormal">d</span><span class="mclose">]</span><span class="mord cjk_fallback">ï¼‰</span><span class="mopen">[</span><span class="mord">âˆ’</span><span class="mord">2</span><span class="mord">0</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mclose">]</span></span></span></span></li>
</ul>
</li>
</ul>
<p><strong>Step 2 - ReRank and Choose 20</strong></p>
<ul>
<li>ä»ä¸Šé¢çš„å€™é€‰åˆ—è¡¨ä¸­é€‰æ‹©å‡ºç°é¢‘ç‡æœ€é«˜çš„20ä¸ªä½œä¸ºæœ€ç»ˆé¢„æµ‹ç»“æœ</li>
</ul>
<h4 id="å€™é€‰å•†å“ç”Ÿæˆ-2"><a class="markdownIt-Anchor" href="#å€™é€‰å•†å“ç”Ÿæˆ-2"></a> å€™é€‰å•†å“ç”Ÿæˆ</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys  <span class="comment"># å¯¼å…¥sysæ¨¡å—</span></span><br><span class="line"><span class="keyword">import</span> gc  <span class="comment"># å¯¼å…¥gcæ¨¡å—</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_pairs</span>(<span class="params">df</span>):  <span class="comment"># å®šä¹‰ä¸€ä¸ªå‡½æ•°ç”¨äºç”Ÿæˆpairs</span></span><br><span class="line">   df = df.query(<span class="string">&#x27;session % @SAMPLING == 0&#x27;</span>).groupby(<span class="string">&#x27;session&#x27;</span>, as_index=<span class="literal">False</span>, sort=<span class="literal">False</span>).apply(<span class="keyword">lambda</span> g: g.tail(<span class="number">30</span>)).reset_index(drop=<span class="literal">True</span>)  <span class="comment"># æ ¹æ®æ¡ä»¶ç­›é€‰æ•°æ®å¹¶æˆªå–æ¯ä¸ªä¼šè¯çš„æœ€å30æ¡è®°å½•</span></span><br><span class="line">   df = pd.merge(df, df, on=<span class="string">&#x27;session&#x27;</span>)  <span class="comment"># åœ¨ä¼šè¯ä¸Šè¿›è¡Œè‡ªè¿æ¥</span></span><br><span class="line">   pairs = df.query(<span class="string">&#x27;abs(ts_x - ts_y) &lt; 24 * 60 * 60 * 1000 and aid_x != aid_y&#x27;</span>)[[<span class="string">&#x27;session&#x27;</span>, <span class="string">&#x27;aid_x&#x27;</span>, <span class="string">&#x27;aid_y&#x27;</span>]].drop_duplicates()  <span class="comment"># ç­›é€‰æ»¡è¶³æ¡ä»¶çš„æ•°æ®å¯¹</span></span><br><span class="line">   <span class="keyword">return</span> pairs[[<span class="string">&#x27;aid_x&#x27;</span>, <span class="string">&#x27;aid_y&#x27;</span>]].values  <span class="comment"># è¿”å›æ•°æ®å¯¹ä¸­çš„&#x27;aid_x&#x27;å’Œ&#x27;aid_y&#x27;å€¼</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_aid_pairs</span>():  <span class="comment"># å®šä¹‰ä¸€ä¸ªå‡½æ•°ç”Ÿæˆaid_pairs </span></span><br><span class="line">   all_pairs = defaultdict(<span class="keyword">lambda</span>: Counter())  <span class="comment"># åˆå§‹åŒ–ä¸€ä¸ªç©ºå­—å…¸ç”¨äºå­˜å‚¨æ‰€æœ‰æ•°æ®é…å¯¹</span></span><br><span class="line">   all_pair_chunks = []  <span class="comment"># åˆå§‹åŒ–ä¸€ä¸ªç©ºåˆ—è¡¨ç”¨äºå­˜å‚¨æ‰€æœ‰çš„æ•°æ®å—</span></span><br><span class="line">   <span class="keyword">with</span> tqdm(glob.glob(<span class="string">&#x27;../input/otto-chunk-data-inparquet-format/*_parquet/*&#x27;</span>), desc=<span class="string">&#x27;Chunks&#x27;</span>) <span class="keyword">as</span> prog:  <span class="comment"># ä½¿ç”¨tqdmæ¥å±•ç¤ºè¿›åº¦æ¡ï¼Œå¹¶éå†æ–‡ä»¶</span></span><br><span class="line">       <span class="keyword">for</span> idx, chunk_file <span class="keyword">in</span> <span class="built_in">enumerate</span>(prog):  <span class="comment"># éå†æ–‡ä»¶</span></span><br><span class="line">           <span class="keyword">with</span> multiprocessing.Pool() <span class="keyword">as</span> p:  <span class="comment"># åˆ›å»ºå¤šè¿›ç¨‹æ± </span></span><br><span class="line">               chunk = pd.read_parquet(chunk_file).drop(columns=[<span class="string">&#x27;type&#x27;</span>])  <span class="comment"># ä»parquetæ–‡ä»¶ä¸­è¯»å–æ•°æ®å—</span></span><br><span class="line">               pair_chunks = p.<span class="built_in">map</span>(gen_pairs, np.array_split(chunk, <span class="number">120</span>))  <span class="comment"># å°†æ•°æ®å—æ‹†åˆ†å¹¶ä½¿ç”¨gen_pairså‡½æ•°ç”Ÿæˆæ•°æ®å¯¹</span></span><br><span class="line">               pair_chunks = np.concatenate(pair_chunks, axis=<span class="number">0</span>)  <span class="comment"># å°†æ•°æ®å—è¿æ¥æˆä¸€ä¸ªæ•°ç»„</span></span><br><span class="line">               all_pair_chunks.append(pair_chunks)  <span class="comment"># å°†æ•°æ®å—æ·»åŠ åˆ°æ•°æ®å—åˆ—è¡¨ä¸­</span></span><br><span class="line"></span><br><span class="line">               <span class="keyword">if</span> DEBUG <span class="keyword">and</span> idx &gt;= <span class="number">3</span>:  <span class="comment"># å¦‚æœå¤„äºDEBUGæ¨¡å¼ä¸”ç´¢å¼•å¤§äºç­‰äº3æ—¶ï¼Œè·³å‡ºå¾ªç¯</span></span><br><span class="line">                   <span class="keyword">break</span></span><br><span class="line">               <span class="keyword">del</span> chunk, pair_chunks  <span class="comment"># åˆ é™¤æ•°æ®å—å’Œæ•°æ®å¯¹</span></span><br><span class="line">               gc.collect()  <span class="comment"># å›æ”¶å†…å­˜</span></span><br><span class="line"></span><br><span class="line">   df = pd.DataFrame(data=np.concatenate(all_pair_chunks), columns=[<span class="string">&#x27;aid1&#x27;</span>, <span class="string">&#x27;aid2&#x27;</span>])  <span class="comment"># åˆ›å»ºåŒ…å«æ‰€æœ‰æ•°æ®å¯¹çš„æ•°æ®æ¡†</span></span><br><span class="line">   top_aids = df.groupby(<span class="string">&#x27;aid1&#x27;</span>).apply(<span class="keyword">lambda</span> df: Counter(df.aid2).most_common(<span class="number">40</span>)).to_dict()  <span class="comment"># æ ¹æ®&#x27;aid1&#x27;åˆ†ç»„ï¼Œå¹¶è·å–å‰40ä¸ªæœ€å¸¸è§çš„&#x27;aid2&#x27;å€¼</span></span><br><span class="line">   <span class="keyword">return</span> top_aids  <span class="comment"># è¿”å›æ¯ä¸ª&#x27;aid1&#x27;å¯¹åº”çš„å‰40ä¸ªæœ€å¸¸è§çš„&#x27;aid2&#x27;å€¼çš„å­—å…¸</span></span><br><span class="line"><span class="comment">#    top_aidsçš„æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="comment">#    &#123;aid1: [(aid2, count), (aid2, count), ...], aid1: [(aid2, count), (aid2, count), ...], ...&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="é‡æ’åä¸æœ€ç»ˆé€‰æ‹©-2"><a class="markdownIt-Anchor" href="#é‡æ’åä¸æœ€ç»ˆé€‰æ‹©-2"></a> é‡æ’åä¸æœ€ç»ˆé€‰æ‹©</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">suggest_aids</span>(<span class="params">df</span>):</span><br><span class="line">    <span class="comment"># é€‰æ‹©ç”¨æˆ·æœ€åæ“ä½œçš„20ä¸ªå•†å“id</span></span><br><span class="line">    aids = df.tail(<span class="number">20</span>).aid.tolist()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(aids) &gt;= <span class="number">20</span>:</span><br><span class="line">        <span class="keyword">return</span> aids</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># æœ€åçš„è¡Œä¸ºä¸å¤Ÿ20ä¸ª,å°±ä»top_40_cntä¸­æ‰¾åˆ°ä¸ç”¨æˆ·æœ€åè¡Œä¸ºæœ€ç›¸å…³çš„å•†å“</span></span><br><span class="line">    aids = <span class="built_in">set</span>(aids)</span><br><span class="line">    new_aids = Counter()</span><br><span class="line">    <span class="keyword">for</span> aid <span class="keyword">in</span> aids:</span><br><span class="line">        new_aids.update(top_40_cnt.get(aid, Counter()))</span><br><span class="line">    <span class="comment"># é€‰å–å‡ºç°æ¬¡æ•°æœ€å¤šçš„å•†å“</span></span><br><span class="line">    top_aids2 = [aid2 <span class="keyword">for</span> aid2, cnt <span class="keyword">in</span> new_aids.most_common(<span class="number">20</span>) <span class="keyword">if</span> aid2 <span class="keyword">not</span> <span class="keyword">in</span> aids]        </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">list</span>(aids) + top_aids2[:<span class="number">20</span> - <span class="built_in">len</span>(aids)]</span><br><span class="line"></span><br><span class="line">pred_df = test_df.sort_values([<span class="string">&quot;session&quot;</span>, <span class="string">&quot;type&quot;</span>, <span class="string">&quot;ts&quot;</span>]).groupby([<span class="string">&quot;session&quot;</span>]).apply(</span><br><span class="line">    <span class="keyword">lambda</span> x: suggest_aids(x)</span><br><span class="line">)</span><br><span class="line"><span class="comment">##################</span></span><br><span class="line"><span class="comment"># BELOW IS CODE ADDED BY CHRIS</span></span><br><span class="line"><span class="comment"># å°†click, order, cartçš„é¢„æµ‹ç»“æœåˆ†å¼€å¤„ç†</span></span><br></pre></td></tr></table></figure>
<h3 id="how-to-build-a-gbt-ranker-model"><a class="markdownIt-Anchor" href="#how-to-build-a-gbt-ranker-model"></a> How To Build a GBT Ranker Model</h3>
<p><a target="_blank" rel="noopener" href="https://www.kaggle.com/code/radek1/training-an-xgboost-ranker-on-the-gpu">ğŸ† Training an XGBoost Ranker on the GPU ğŸ”¥ğŸ”¥ğŸ”¥</a><br />
<a target="_blank" rel="noopener" href="https://www.kaggle.com/code/radek1/polars-proof-of-concept-lgbm-ranker">ğŸ’¡ [polars] Proof of concept: LGBM RankerğŸ§ªğŸ§ªğŸ§ª</a><br />
<a target="_blank" rel="noopener" href="https://www.kaggle.com/competitions/otto-recommender-system/discussion/370210">How To Build a GBT Ranker Model</a></p>
<p><strong>Step 1 - Generate Candidates</strong><br />
ä½¿ç”¨ä¸Šé¢çš„æ–¹æ³•ç”Ÿæˆå€™é€‰å•†å“åˆ—è¡¨<br />
æ¯è¡Œä¸€ä¸ªsessionä¸€ä¸ªaid,æ•°æ®å†…å®¹å¦‚ä¸‹</p>
<ul>
<li>session (i.e. user)</li>
<li>aid (i.e. item)</li>
<li>user features</li>
<li>item features</li>
<li>user-item interaction features</li>
<li>click target (i.e 0 or 1)</li>
<li>cart target (i.e. 0 or 1)</li>
<li>order target (i.e. 0 or 1)</li>
</ul>
<p><strong>Step 2 - ReRank and Choose 20</strong><br />
ä½¿ç”¨GBTæ¨¡å‹æœ€ç»ˆçš„20ä¸ªå•†å“è¿›è¡Œé¢„æµ‹</p>
<ol>
<li>
<p>Step 1<br />
æ„å»ºæ¨¡å‹çš„æ•°æ®é›†:è®­ç»ƒæ•°æ®æ˜¯å…¬å¼€æ•°æ®çš„å‰ä¸‰å‘¨,éªŒè¯æ•°æ®æ˜¯ç¬¬å››å‘¨.<br />
éªŒè¯æ•°æ®åˆè¢«åˆ†ä¸ºvalid A å’Œvalid B, Bæ˜¯ground truth<br />
å¯¹æ¯ä¸ªsessionå…ˆç»™å‡º50ä¸ªå€™é€‰å•†å“id,ç„¶åå¾—åˆ°äº†ä¸€ä¸ª(number_of_session * 50, 2)å¤§å°çš„dataframe,ç±»ä¼¼:<br />
| session | aid |<br />
| â€” | â€” |<br />
| 1 | 1234 |<br />
| 1 | 9841 |<br />
| 2 | 5845 |<br />
| 2 | 8984 |</p>
</li>
<li>
<p>Setp 2<br />
åˆ›å»ºå•†å“ç‰¹å¾(item feature),ä½¿ç”¨è®­ç»ƒæ•°æ®å’ŒéªŒè¯æ•°æ®A</p>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">item_features = train.groupby(<span class="string">&#x27;aid&#x27;</span>).agg(&#123;<span class="string">&#x27;aid&#x27;</span>:<span class="string">&#x27;count&#x27;</span>,<span class="string">&#x27;session&#x27;</span>:<span class="string">&#x27;nunique&#x27;</span>,<span class="string">&#x27;type&#x27;</span>:<span class="string">&#x27;mean&#x27;</span>&#125;)</span><br><span class="line">item_features.columns = [<span class="string">&#x27;item_item_count&#x27;</span>,<span class="string">&#x27;item_user_count&#x27;</span>,<span class="string">&#x27;item_buy_ratio&#x27;</span>]</span><br><span class="line"><span class="comment"># åˆ†åˆ«æ˜¯å•†å“-å•†å“çš„å…³ç³»,å•†å“-ç”¨æˆ·çš„ç«çƒ­åº¦,å•†å“-è´­ä¹°ç³»æ•°æ¦‚ç‡</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>Setp 3<br />
åˆ›å»ºç”¨æˆ·ç‰¹å¾(user feature),ä½¿ç”¨éªŒè¯æ•°æ®A</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">user_features = train.groupby(<span class="string">&#x27;session&#x27;</span>).agg(&#123;<span class="string">&#x27;session&#x27;</span>:<span class="string">&#x27;count&#x27;</span>,<span class="string">&#x27;aid&#x27;</span>:<span class="string">&#x27;nunique&#x27;</span>,<span class="string">&#x27;type&#x27;</span>:<span class="string">&#x27;mean&#x27;</span>&#125;)</span><br><span class="line">user_features.columns = [<span class="string">&#x27;user_user_count&#x27;</span>,<span class="string">&#x27;user_item_count&#x27;</span>,<span class="string">&#x27;user_buy_ratio&#x27;</span>]</span><br><span class="line"><span class="comment"># åˆ†åˆ«æ˜¯ç”¨æˆ·-ç”¨æˆ·çš„å…³ç³»,ç”¨æˆ·-å•†å“çš„è´­ä¹°äº†,ç”¨æˆ·-è´­ä¹°ç³»æ•°æ¦‚ç‡</span></span><br></pre></td></tr></table></figure>
<ol start="4">
<li>
<p>Setp 4<br />
åˆ›å»ºç”¨æˆ·-å•†å“äº¤äº’ç‰¹å¾(user-item interaction feature),ä½¿ç”¨éªŒè¯æ•°æ®A<br />
æ€è·¯å¾ˆå¤šæ²¡æœ‰å…·ä½“ç»™å‡º.ä¾‹å¦‚:<br />
åˆ›å»ºç”¨æˆ·-å•†å“ç‚¹å‡»äº¤äº’ç‰¹å¾<br />
| session | aid | item_click|<br />
| â€” | â€” | â€” |</p>
</li>
<li>
<p>Setp 5<br />
å°†ç‰¹å¾æ·»åŠ åˆ°candidate dataframeä¸­</p>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">candidates = candidates.merge(item_features, left_on=<span class="string">&#x27;aid&#x27;</span>, right_index=<span class="literal">True</span>, how=<span class="string">&#x27;left&#x27;</span>).fillna(-<span class="number">1</span>)</span><br><span class="line">candidates = candidates.merge(user_features, left_on=<span class="string">&#x27;session&#x27;</span>, right_index=<span class="literal">True</span>, how=<span class="string">&#x27;left&#x27;</span>).fillna(-<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>ç„¶åcandidate dataframeç±»ä¼¼:</p>
<table>
<thead>
<tr>
<th>session</th>
<th>aid</th>
<th>item_feat1</th>
<th>item_feat2</th>
<th>user_feat1</th>
<th>user_feat2</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1234</td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>4</td>
</tr>
<tr>
<td>1</td>
<td>9841</td>
<td>5</td>
<td>6</td>
<td>7</td>
<td>8</td>
</tr>
<tr>
<td>2</td>
<td>5845</td>
<td>9</td>
<td>10</td>
<td>11</td>
<td>12</td>
</tr>
<tr>
<td>2</td>
<td>8984</td>
<td>13</td>
<td>14</td>
<td>15</td>
<td>16</td>
</tr>
</tbody>
</table>
<ol start="6">
<li>Setp 6<br />
æ„å»ºground truth,ä¾‹å¦‚<code>test_labels.parquet</code>:<br />
| session | type | ground_truth |<br />
| â€” | â€” | â€” |<br />
| 1 | carts | [5456,4545,98741,2355] |<br />
| 2 | carts | [1257,8653,2547] |</li>
</ol>
<p>ç„¶åå°†å…¶è½¬æ¢ä¸ºå¦‚ä¸‹:</p>
<table>
<thead>
<tr>
<th>session</th>
<th>aid</th>
<th>cart</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>5456</td>
<td>1</td>
</tr>
<tr>
<td>1</td>
<td>4545</td>
<td>1</td>
</tr>
<tr>
<td>1</td>
<td>98741</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>ç„¶åå°†å…¶åˆå¹¶åˆ°candidate dataframeä¸­</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">candidates = candidates.merge(cart_target,on=[<span class="string">&#x27;user&#x27;</span>,<span class="string">&#x27;item&#x27;</span>],how=<span class="string">&#x27;left&#x27;</span>).fillna(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p>candidates dataframeç±»ä¼¼:</p>
<table>
<thead>
<tr>
<th>session</th>
<th>aid</th>
<th>item_feat1</th>
<th>item_feat2</th>
<th>user_feat1</th>
<th>user_feat2</th>
<th>cart</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1234</td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>4</td>
<td>0</td>
</tr>
<tr>
<td>1</td>
<td>9841</td>
<td>5</td>
<td>6</td>
<td>7</td>
<td>8</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>5845</td>
<td>9</td>
<td>10</td>
<td>11</td>
<td>12</td>
<td>0</td>
</tr>
<tr>
<td>2</td>
<td>8984</td>
<td>13</td>
<td>14</td>
<td>15</td>
<td>16</td>
<td>1</td>
</tr>
</tbody>
</table>
<ol start="7">
<li>Setp 7<br />
è®­ç»ƒ,ä¸é€‚ç”¨userå’Œaidåˆ—:</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> xgboost <span class="keyword">as</span> xgb  <span class="comment"># å¯¼å…¥XGBooståº“</span></span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> GroupKFold  <span class="comment"># ä»sklearnåº“ä¸­å¯¼å…¥GroupKFoldæ¨¡å—</span></span><br><span class="line"></span><br><span class="line">skf = GroupKFold(n_splits=<span class="number">5</span>)  <span class="comment"># ä½¿ç”¨GroupKFoldæ–¹æ³•åˆ’åˆ†æ•°æ®é›†ä¸º5æŠ˜äº¤å‰éªŒè¯</span></span><br><span class="line"><span class="comment"># groupså‚æ•°çš„ä½œç”¨æ˜¯æŒ‡å®šç”¨äºåˆ†ç»„çš„ç‰¹å¾åˆ—ã€‚åœ¨GroupKFoldäº¤å‰éªŒè¯ä¸­ï¼Œé€šè¿‡æŒ‡å®šgroupså‚æ•°ï¼Œå¯ä»¥ç¡®ä¿åœ¨äº¤å‰éªŒè¯è¿‡ç¨‹ä¸­ï¼ŒåŒä¸€ç»„å†…çš„æ•°æ®æ ·æœ¬ä¸ä¼šåŒæ—¶å‡ºç°åœ¨è®­ç»ƒé›†å’ŒéªŒè¯é›†ä¸­ï¼Œä»¥é¿å…æ•°æ®æ³„éœ²å’Œæé«˜æ¨¡å‹çš„å‡†ç¡®æ€§ã€‚åœ¨è¿™é‡Œï¼Œcandidates[&#x27;user&#x27;]åˆ—è¢«ç”¨ä½œåˆ†ç»„çš„ç‰¹å¾åˆ—ï¼Œä»¥ç¡®ä¿æ¯ä¸ªç”¨æˆ·çš„æ•°æ®åœ¨äº¤å‰éªŒè¯æ—¶èƒ½å¤Ÿä¿æŒç‹¬ç«‹ã€‚</span></span><br><span class="line"><span class="keyword">for</span> fold, (train_idx, valid_idx) <span class="keyword">in</span> <span class="built_in">enumerate</span>(skf.split(candidates, candidates[<span class="string">&#x27;click&#x27;</span>], groups=candidates[<span class="string">&#x27;user&#x27;</span>])):  <span class="comment"># éå†æ¯ä¸€ä¸ªäº¤å‰éªŒè¯æŠ˜æ•°</span></span><br><span class="line"></span><br><span class="line">   X_train = candidates.loc[train_idx, FEATURES]  <span class="comment"># è·å–è®­ç»ƒé›†ç‰¹å¾æ•°æ®</span></span><br><span class="line">   y_train = candidates.loc[train_idx, <span class="string">&#x27;click&#x27;</span>]  <span class="comment"># è·å–è®­ç»ƒé›†æ ‡ç­¾æ•°æ®</span></span><br><span class="line">   X_valid = candidates.loc[valid_idx, FEATURES]  <span class="comment"># è·å–éªŒè¯é›†ç‰¹å¾æ•°æ®</span></span><br><span class="line">   y_valid = candidates.loc[valid_idx, <span class="string">&#x27;click&#x27;</span>]  <span class="comment"># è·å–éªŒè¯é›†æ ‡ç­¾æ•°æ®</span></span><br><span class="line"></span><br><span class="line">   <span class="comment"># å¦‚æœæœ‰50ä¸ªå€™é€‰é¡¹ï¼Œåˆ™ä½¿ç”¨50ä¸ªä½œä¸ºåˆ†ç»„ä¿¡æ¯</span></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªXGBoostä¸­çš„DMatrixå¯¹è±¡ï¼Œç”¨äºå­˜å‚¨è®­ç»ƒé›†çš„ç‰¹å¾æ•°æ®ã€æ ‡ç­¾æ•°æ®ä»¥åŠåˆ†ç»„ä¿¡æ¯ã€‚</span></span><br><span class="line"><span class="comment"># åˆ›å»ºDMatrixå¯¹è±¡ï¼Œå¯ä»¥ä½¿è®­ç»ƒæ•°æ®æ›´é«˜æ•ˆåœ°ä¼ é€’ç»™XGBoostæ¨¡å‹ï¼Œå¹¶ä¸”èƒ½å¤Ÿåˆ©ç”¨åˆ†ç»„ä¿¡æ¯ä¼˜åŒ–æ¨¡å‹çš„å­¦ä¹ è¿‡ç¨‹ã€‚</span></span><br><span class="line">   dtrain = xgb.DMatrix(X_train, y_train, group=[<span class="number">50</span>] * (<span class="built_in">len</span>(train_idx)//<span class="number">50</span>) )  <span class="comment"># åˆ›å»ºè®­ç»ƒé›†çš„DMatrix</span></span><br><span class="line">   dvalid = xgb.DMatrix(X_valid, y_valid, group=[<span class="number">50</span>] * (<span class="built_in">len</span>(valid_idx)//<span class="number">50</span>) )  <span class="comment"># åˆ›å»ºéªŒè¯é›†çš„DMatrix</span></span><br><span class="line"></span><br><span class="line">   xgb_parms = &#123;<span class="string">&#x27;objective&#x27;</span>:<span class="string">&#x27;rank:pairwise&#x27;</span>, <span class="string">&#x27;tree_method&#x27;</span>:<span class="string">&#x27;gpu_hist&#x27;</span>&#125;  <span class="comment"># è®¾ç½®XGBoostçš„å‚æ•°</span></span><br><span class="line">   model = xgb.train(xgb_parms, </span><br><span class="line">       dtrain=dtrain,</span><br><span class="line">       evals=[(dtrain,<span class="string">&#x27;train&#x27;</span>),(dvalid,<span class="string">&#x27;valid&#x27;</span>)],</span><br><span class="line">       num_boost_round=<span class="number">1000</span>,</span><br><span class="line">       verbose_eval=<span class="number">100</span>)  <span class="comment"># è®­ç»ƒXGBoostæ¨¡å‹</span></span><br><span class="line">   model.save_model(<span class="string">f&#x27;XGB_fold<span class="subst">&#123;fold&#125;</span>_click.xgb&#x27;</span>)  <span class="comment"># ä¿å­˜è®­ç»ƒå¥½çš„æ¨¡å‹</span></span><br></pre></td></tr></table></figure>
<ol start="8">
<li>Setp 8<br />
æ¨ç†:ä¸ºäº†è¿›è¡Œæ¨ç†ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å€™é€‰æ•°æ®å¸§ï¼Œä½†è¿™æ¬¡æ˜¯æ ¹æ®Kaggleçš„æµ‹è¯•æ•°æ®ã€‚ç„¶åï¼Œæˆ‘ä»¬ä»Kaggleè®­ç»ƒçš„æ‰€æœ‰4å‘¨åŠ ä¸ŠKaggleæµ‹è¯•çš„1å‘¨ä¸­åˆ¶ä½œé¡¹ç›®ç‰¹å¾(item feature)ã€‚æˆ‘ä»¬é€šè¿‡Kaggleæµ‹è¯•åˆ¶ä½œç”¨æˆ·ç‰¹å¾(user feature)ã€‚æˆ‘ä»¬å°†è¿™äº›ç‰¹å¾åˆå¹¶åˆ°æˆ‘ä»¬çš„å€™é€‰è€…ä¸­ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ä¿å­˜çš„æ¨¡å‹æ¥æ¨æ–­ç‚¹å‡»é‡çš„é¢„æµ‹ã€‚æœ€åï¼Œæˆ‘ä»¬é€šè¿‡å¯¹é¢„æµ‹è¿›è¡Œæ’åºå¹¶é€‰æ‹©20ä¸ªã€‚</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">preds = np.zeros(<span class="built_in">len</span>(test_candidates))  <span class="comment"># åˆå§‹åŒ–ä¸€ä¸ªå…¨é›¶æ•°ç»„ç”¨äºå­˜å‚¨é¢„æµ‹å€¼</span></span><br><span class="line"><span class="keyword">for</span> fold <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):  <span class="comment"># éå†5ä¸ªäº¤å‰éªŒè¯æŠ˜æ•°</span></span><br><span class="line">   model = xgb.Booster()  <span class="comment"># åˆ›å»ºä¸€ä¸ªXGBoostæ¨¡å‹</span></span><br><span class="line">   model.load_model(<span class="string">f&#x27;XGB_fold<span class="subst">&#123;fold&#125;</span>_click.xgb&#x27;</span>)  <span class="comment"># è½½å…¥è®­ç»ƒå¥½çš„XGBoostæ¨¡å‹</span></span><br><span class="line">   model.set_param(&#123;<span class="string">&#x27;predictor&#x27;</span>: <span class="string">&#x27;gpu_predictor&#x27;</span>&#125;)  <span class="comment"># è®¾ç½®æ¨¡å‹å‚æ•°ä¸ºGPUåŠ é€Ÿé¢„æµ‹</span></span><br><span class="line">   dtest = xgb.DMatrix(data=test_candidates[FEATURES])  <span class="comment"># åˆ›å»ºæµ‹è¯•é›†çš„DMatrixå¯¹è±¡</span></span><br><span class="line"><span class="comment"># ç»“æœæ˜¯æ¯ä¸ªå€™é€‰å€¼çš„é¢„æµ‹å¾—åˆ†ï¼ˆæ¦‚ç‡ï¼‰</span></span><br><span class="line">   preds += model.predict(dtest)/<span class="number">5</span>  <span class="comment"># å¯¹æµ‹è¯•é›†è¿›è¡Œé¢„æµ‹ï¼Œå¹¶å°†ç»“æœç´¯åŠ æ±‚å¹³å‡</span></span><br><span class="line"></span><br><span class="line">predictions = test_candidates[[<span class="string">&#x27;user&#x27;</span>,<span class="string">&#x27;item&#x27;</span>]].copy()  <span class="comment"># å¤åˆ¶æµ‹è¯•é›†çš„&#x27;user&#x27;å’Œ&#x27;item&#x27;åˆ—ä½œä¸ºé¢„æµ‹ç»“æœçš„åŸºç¡€</span></span><br><span class="line">predictions[<span class="string">&#x27;pred&#x27;</span>] = preds  <span class="comment"># å°†é¢„æµ‹ç»“æœæ·»åŠ åˆ°predictionsä¸­</span></span><br><span class="line"></span><br><span class="line">predictions = predictions.sort_values([<span class="string">&#x27;user&#x27;</span>,<span class="string">&#x27;pred&#x27;</span>], ascending=[<span class="literal">True</span>,<span class="literal">False</span>]).reset_index(drop=<span class="literal">True</span>)  <span class="comment"># å¯¹é¢„æµ‹ç»“æœæŒ‰&#x27;user&#x27;å’Œ&#x27;pred&#x27;è¿›è¡Œæ’åºï¼Œå¹¶é‡ç½®ç´¢å¼•</span></span><br><span class="line">predictions[<span class="string">&#x27;n&#x27;</span>] = predictions.groupby(<span class="string">&#x27;user&#x27;</span>).item.cumcount().astype(<span class="string">&#x27;int8&#x27;</span>)  <span class="comment"># æ ¹æ®&#x27;user&#x27;åˆ†ç»„åï¼Œè®¡ç®—æ¯ä¸ªç”¨æˆ·çš„æ¡ç›®æ•°é‡ä½œä¸ºåºå·</span></span><br><span class="line">predictions = predictions.loc[predictions.n&lt;<span class="number">20</span>]  <span class="comment"># ä¿ç•™æ¯ä¸ªç”¨æˆ·å‰20ä¸ªé¢„æµ‹ç»“æœ</span></span><br><span class="line">sub = predictions.groupby(<span class="string">&#x27;user&#x27;</span>).item.apply(<span class="built_in">list</span>)  <span class="comment"># æ ¹æ®ç”¨æˆ·åˆ†ç»„ï¼Œå°†é¢„æµ‹ç»“æœè½¬æ¢ä¸ºåˆ—è¡¨</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sub = sub.to_frame().reset_index()  <span class="comment"># å°†é¢„æµ‹ç»“æœè½¬æ¢ä¸ºDataFrameæ ¼å¼</span></span><br><span class="line">sub.item = sub.item.apply(<span class="keyword">lambda</span> x: <span class="string">&quot; &quot;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>,x)))  <span class="comment"># å°†åˆ—è¡¨ä¸­çš„æ•°å­—è½¬æ¢ä¸ºå­—ç¬¦ä¸²å¹¶æ‹¼æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line">sub.columns = [<span class="string">&#x27;session_type&#x27;</span>,<span class="string">&#x27;labels&#x27;</span>]  <span class="comment"># é‡å‘½åDataFrameçš„åˆ—å</span></span><br><span class="line">sub.session_type = sub.session_type.astype(<span class="string">&#x27;str&#x27;</span>)+ <span class="string">&#x27;_clicks&#x27;</span>  <span class="comment"># ä¿®æ”¹&#x27;session_type&#x27;åˆ—çš„æ•°æ®ç±»å‹</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="word2vec-how-to-training-and-submission"><a class="markdownIt-Anchor" href="#word2vec-how-to-training-and-submission"></a> ğŸ’¡ Word2Vec How-to [training and submission]ğŸš€ğŸš€ğŸš€</h3>
<p><a target="_blank" rel="noopener" href="https://www.kaggle.com/code/radek1/word2vec-how-to-training-and-submission">ğŸ’¡ Word2Vec How-to [training and submission]ğŸš€ğŸš€ğŸš€</a></p>
<p>A session where one action follows another action is very much like a sentence!</p>
<p>ç±»ä¼¼åœ°ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™æ ·ä¸€ä¸ªäº‹å®ï¼Œå³åœ¨ä¸€ä¸ªç´§å¯†çš„åºåˆ—ä¸­å‡ºç°çš„å•†å“idå¯èƒ½æœ‰ä¸€äº›ç›¸ä¼¼ä¹‹å¤„ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨word2vecæ¨¡å‹æ¥è®­ç»ƒå•†å“idçš„åµŒå…¥å‘é‡ï¼Œç„¶åä½¿ç”¨è¿™äº›å‘é‡æ¥è®¡ç®—å•†å“idä¹‹é—´çš„ç›¸ä¼¼åº¦ã€‚</p>
<p>è¿™æ ·ç»™å®šä¸€ä¸ªå•†å“çš„idå°±å¯ä»¥æ‰¾åˆ°å’Œå¥¹ç±»ä¼¼çš„å•†å“idã€‚</p>
<h4 id="ä½¿ç”¨word2vecç›´æ¥è·å–20ä¸ªå•†å“"><a class="markdownIt-Anchor" href="#ä½¿ç”¨word2vecç›´æ¥è·å–20ä¸ªå•†å“"></a> ä½¿ç”¨word2vecç›´æ¥è·å–20ä¸ªå•†å“</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># å°†ç”¨æˆ·çš„æ‰€æœ‰è¡Œä¸ºçš„å•†å“idè½¬æ¢ä¸ºä¸€ä¸ªå¥å­,[&#x27;aid1&#x27;,&#x27;aid2&#x27;,&#x27;aid3&#x27;,&#x27;aid4&#x27;]</span></span><br><span class="line">sentences_df = pl.concat([train, test]).groupby(<span class="string">&#x27;session&#x27;</span>).agg(</span><br><span class="line">    pl.col(<span class="string">&#x27;aid&#x27;</span>).alias(<span class="string">&#x27;sentence&#x27;</span>)</span><br><span class="line">)</span><br><span class="line">sentences = sentences_df[<span class="string">&#x27;sentence&#x27;</span>].to_list()</span><br><span class="line"><span class="comment"># è®­ç»ƒword2vecæ¨¡å‹</span></span><br><span class="line">w2vec = Word2Vec(sentences=sentences, vector_size=<span class="number">32</span>, min_count=<span class="number">1</span>, workers=<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ„å»ºaidåˆ°ç´¢å¼•çš„æ˜ å°„å­—å…¸</span></span><br><span class="line">aid2idx = &#123;aid: i <span class="keyword">for</span> i, aid <span class="keyword">in</span> <span class="built_in">enumerate</span>(w2vec. index_to_key)&#125;  </span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªAnnoyç´¢å¼•å¯¹è±¡ï¼ŒæŒ‡å®šå‘é‡ç»´åº¦ä¸º32ï¼Œè·ç¦»åº¦é‡æ–¹å¼ä¸ºæ¬§æ°è·ç¦»</span></span><br><span class="line">index = AnnoyIndex(<span class="number">32</span>, <span class="string">&#x27;euclidean&#x27;</span>)  </span><br><span class="line"></span><br><span class="line"><span class="comment"># éå†aid2idxå­—å…¸</span></span><br><span class="line"><span class="keyword">for</span> aid, idx <span class="keyword">in</span> aid2idx.items():  </span><br><span class="line">   index.add_item(idx, w2vec.wv.vectors[idx])  <span class="comment"># å°†å‘é‡æ·»åŠ åˆ°Annoyç´¢å¼•å¯¹è±¡ä¸­</span></span><br><span class="line">   </span><br><span class="line">index.build(<span class="number">10</span>)  <span class="comment"># æ„å»ºAnnoyç´¢å¼•ï¼Œå…¶ä¸­10è¡¨ç¤ºæ„å»ºç´¢å¼•æ—¶è¦ä½¿ç”¨çš„æ ‘çš„æ•°é‡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># indexå­˜å‚¨çš„æ˜¯ ç´¢å¼•-&gt;å‘é‡</span></span><br><span class="line"><span class="comment"># aid2idxå­˜å‚¨çš„æ˜¯ å•†å“id-&gt;ç´¢å¼•</span></span><br><span class="line">sample_sub = pd.read_csv(<span class="string">&#x27;../input/otto-recommender-system//sample_submission.csv&#x27;</span>)  <span class="comment"># ä»CSVæ–‡ä»¶ä¸­è¯»å–sample_subæ•°æ®</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">é€‰æ‹©æœ€è¿‘çš„20ä¸ªå•†å“</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»æµ‹è¯•é›†ä¸­è·å–æ¯ä¸ªç”¨æˆ·çš„AIDåˆ—è¡¨å’Œç±»å‹åˆ—è¡¨</span></span><br><span class="line">test_session_AIDs = test.to_pandas().reset_index(drop=<span class="literal">True</span>).groupby(<span class="string">&#x27;session&#x27;</span>)[<span class="string">&#x27;aid&#x27;</span>].apply(<span class="built_in">list</span>)</span><br><span class="line">test_session_types = test.to_pandas().reset_index(drop=<span class="literal">True</span>).groupby(<span class="string">&#x27;session&#x27;</span>)[<span class="string">&#x27;type&#x27;</span>].apply(<span class="built_in">list</span>)</span><br><span class="line"></span><br><span class="line">labels = []  <span class="comment"># åˆå§‹åŒ–ä¸€ä¸ªç©ºåˆ—è¡¨ç”¨äºå­˜å‚¨æ ‡ç­¾ç»“æœ</span></span><br><span class="line"></span><br><span class="line">type_weight_multipliers = &#123;<span class="number">0</span>: <span class="number">1</span>, <span class="number">1</span>: <span class="number">6</span>, <span class="number">2</span>: <span class="number">3</span>&#125;  <span class="comment"># å®šä¹‰ç±»å‹æƒé‡</span></span><br><span class="line"><span class="keyword">for</span> AIDs, types <span class="keyword">in</span> <span class="built_in">zip</span>(test_session_AIDs, test_session_types):  <span class="comment"># éå†æµ‹è¯•é›†ä¸­çš„æ¯ä¸ªç”¨æˆ·çš„AIDå’Œç±»å‹</span></span><br><span class="line">   <span class="keyword">if</span> <span class="built_in">len</span>(AIDs) &gt;= <span class="number">20</span>:  <span class="comment"># å¦‚æœAIDæ•°é‡å¤§äºç­‰äº20</span></span><br><span class="line">       <span class="comment"># å¦‚æœæˆ‘ä»¬æœ‰è¶³å¤Ÿçš„AIDï¼ˆå¤§äºç­‰äº20ï¼‰æˆ‘ä»¬ä¸éœ€è¦æŸ¥æ‰¾å€™é€‰é¡¹ï¼æˆ‘ä»¬åªéœ€ä½¿ç”¨æ—§çš„é€»è¾‘</span></span><br><span class="line">       weights=np.logspace(<span class="number">0.1</span>,<span class="number">1</span>,<span class="built_in">len</span>(AIDs),base=<span class="number">2</span>, endpoint=<span class="literal">True</span>)-<span class="number">1</span>  <span class="comment"># æ ¹æ®AIDæ•°é‡ç”Ÿæˆå¯¹åº”çš„æƒé‡</span></span><br><span class="line">       aids_temp=defaultdict(<span class="keyword">lambda</span>: <span class="number">0</span>)  <span class="comment"># åˆå§‹åŒ–ä¸€ä¸ªé»˜è®¤å€¼ä¸º0çš„å­—å…¸</span></span><br><span class="line">       <span class="keyword">for</span> aid,w,t <span class="keyword">in</span> <span class="built_in">zip</span>(AIDs,weights,types):  <span class="comment"># éå†AIDï¼Œæƒé‡å’Œç±»å‹</span></span><br><span class="line">           aids_temp[aid]+= w * type_weight_multipliers[t]  <span class="comment"># æ ¹æ®AIDå’Œç±»å‹è®¡ç®—åŠ æƒå¾—åˆ†</span></span><br><span class="line">       </span><br><span class="line">       sorted_aids=[k <span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="built_in">sorted</span>(aids_temp.items(), key=<span class="keyword">lambda</span> item: -item[<span class="number">1</span>])]  <span class="comment"># æŒ‰ç…§åŠ æƒå¾—åˆ†å¯¹AIDè¿›è¡Œæ’åº</span></span><br><span class="line">       labels.append(sorted_aids[:<span class="number">20</span>])  <span class="comment"># å°†å‰20ä¸ªAIDæ·»åŠ åˆ°æ ‡ç­¾ä¸­</span></span><br><span class="line">   <span class="keyword">else</span>:  <span class="comment"># å¦‚æœAIDæ•°é‡å°äº20</span></span><br><span class="line">       <span class="comment"># è¿™é‡Œæˆ‘ä»¬æ²¡æœ‰20ä¸ªAIDè¦è¾“å‡º-æˆ‘ä»¬å°†ä½¿ç”¨word2vecåµŒå…¥æ¥ç”Ÿæˆå€™é€‰é¡¹ï¼</span></span><br><span class="line">       AIDs = <span class="built_in">list</span>(<span class="built_in">dict</span>.fromkeys(AIDs[::-<span class="number">1</span>]))  <span class="comment"># ç§»é™¤é‡å¤é¡¹å¹¶åè½¬AIDåˆ—è¡¨</span></span><br><span class="line"></span><br><span class="line">       <span class="comment"># è·å–æ—¶é—´æœ€è¿‘çš„AID</span></span><br><span class="line">       most_recent_aid = AIDs[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># most_recent_aidæ˜¯å•†å“id,aid2idx[most_recent_aid]æ‹¿åˆ°å¯¹åº”çš„ç´¢å¼•</span></span><br><span class="line">        <span class="comment"># index.get_nns_by_item(aid2idx[most_recent_aid], 21)æ ¹æ®ç´¢å¼•è·å–å‘é‡å¹¶è®¡ç®—æœ€è¿‘çš„21ä¸ªå•†å“</span></span><br><span class="line">       <span class="comment"># å¯»æ‰¾ä¸€äº›é‚»å±…</span></span><br><span class="line">       nns = [w2vec.wv.index_to_key[i] <span class="keyword">for</span> i <span class="keyword">in</span> index.get_nns_by_item(aid2idx[most_recent_aid], <span class="number">21</span>)[<span class="number">1</span>:]]  <span class="comment"># ä½¿ç”¨Annoyç´¢å¼•æ‰¾åˆ°æœ€è¿‘é‚»çš„AID</span></span><br><span class="line">       labels.append((AIDs+nns)[:<span class="number">20</span>])  <span class="comment"># å°†AIDå’Œé‚»å±…çš„AIDç»„åˆï¼Œå–å‰20ä¸ªä½œä¸ºæ ‡ç­¾</span></span><br></pre></td></tr></table></figure>
<h4 id="ä½¿ç”¨word2vec-è·å–å€™é€‰å•†å“"><a class="markdownIt-Anchor" href="#ä½¿ç”¨word2vec-è·å–å€™é€‰å•†å“"></a> ä½¿ç”¨word2vec è·å–å€™é€‰å•†å“</h4>
<p>å’Œcovisiation matrixç±»ä¼¼,ä½¿ç”¨word2vecå¯ä»¥è·å–æœ€ç›¸å…³çš„å•†å“</p>
<p>æ•°æ®ä¸º:</p>
<table>
<thead>
<tr>
<th>session</th>
<th>aid</th>
<th>type</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>10</td>
<td>0</td>
</tr>
<tr>
<td>1</td>
<td>20</td>
<td>0</td>
</tr>
<tr>
<td>2</td>
<td>20</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>30</td>
<td>0</td>
</tr>
</tbody>
</table>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">å‡å¦‚é€šè¿‡ä¸Šé¢çš„ä»£ç æˆ‘ä»¬å·²ç»ç±»ä¼¼çš„è·å–åˆ°äº†æœ€ç›¸å…³çš„å•†å“</span><br><span class="line">| session | aid |</span><br><span class="line">| --- | --- |</span><br><span class="line">| <span class="number">1</span> | <span class="number">11</span> | </span><br><span class="line">| <span class="number">1</span> | <span class="number">20</span> |</span><br><span class="line">| <span class="number">2</span> | <span class="number">25</span> | </span><br><span class="line">| <span class="number">2</span> | <span class="number">6</span> | </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">é‚£ä¹ˆä¸‹é¢è¿˜æœ‰å‡ ä¸ªæ­¥éª¤</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span> Step <span class="number">1</span>: Add ordering information to our candidates.</span><br><span class="line">word2vecæ¨¡å‹æ˜¯æŒ‰ç…§ç›¸ä¼¼åº¦è¯„åˆ†æ¥æ’åºçš„,æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€äº›æ’åºä¿¡æ¯</span><br><span class="line"></span><br><span class="line">| session | aid | rank |</span><br><span class="line">| --- | --- | --- |</span><br><span class="line">| <span class="number">1</span> | <span class="number">11</span> | <span class="number">1</span> |</span><br><span class="line">| <span class="number">1</span> | <span class="number">20</span> | <span class="number">2</span> |</span><br><span class="line">| <span class="number">2</span> | <span class="number">25</span> | <span class="number">1</span> |</span><br><span class="line">| <span class="number">2</span> | <span class="number">6</span> | <span class="number">2</span> |</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> å°†è¿™äº›ä¿¡æ¯åˆå¹¶åˆ°candidatesä¸­</span><br><span class="line">| session | aid | rank | <span class="built_in">type</span> |</span><br><span class="line">| --- | --- | --- | --- |</span><br><span class="line">| <span class="number">1</span> | <span class="number">11</span> | <span class="number">1</span> | null |</span><br><span class="line">| <span class="number">1</span> | <span class="number">20</span> | <span class="number">2</span> | <span class="number">0</span> |</span><br><span class="line">| <span class="number">1</span> | <span class="number">10</span> | null | <span class="number">0</span> |</span><br><span class="line">| <span class="number">2</span> | <span class="number">25</span> | <span class="number">1</span> | null |</span><br><span class="line">| <span class="number">2</span> | <span class="number">6</span> | <span class="number">2</span> | null |</span><br><span class="line">| <span class="number">2</span> | <span class="number">20</span> | null | <span class="number">1</span> |</span><br><span class="line">| <span class="number">2</span> | <span class="number">30</span> | null | <span class="number">0</span> |</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">3.</span> ä½¿ç”¨Rankeræ¨¡å‹è¿›è¡Œé¢„æµ‹,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### ğŸ’¡ [2 methods] How-to ensemble predictions ğŸ…ğŸ…ğŸ…</span></span><br><span class="line">[ğŸ’¡ [<span class="number">2</span> methods] How-to ensemble predictions ğŸ…ğŸ…ğŸ…](https://www.kaggle.com/code/radek1/<span class="number">2</span>-methods-how-to-ensemble-predictions)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å¯¹é¢„æµ‹ç»“æœé›†æˆ:</span><br><span class="line">- æŠ•ç¥¨é›†æˆ(voting ensemble)</span><br><span class="line">- åŠ æƒæŠ•ç¥¨é›†æˆ(voting ensemble <span class="keyword">with</span> weights),å¯¹å¥½ç»“æœæœ‰æ›´å¤§çš„æƒé‡</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_sub</span>(<span class="params">path, weight=<span class="number">1</span></span>):  <span class="comment"># å®šä¹‰ä¸€ä¸ªå‡½æ•°ç”¨äºåŠ è½½å’Œé¢„å¤„ç†æäº¤ç»“æœ</span></span><br><span class="line">   <span class="string">&#x27;&#x27;&#x27;a helper function for loading and preprocessing submissions&#x27;&#x27;&#x27;</span></span><br><span class="line">   <span class="keyword">return</span> (</span><br><span class="line">       pl.read_csv(path)  <span class="comment"># ä»è·¯å¾„ä¸­è¯»å–CSVæ–‡ä»¶</span></span><br><span class="line">           .with_column(pl.col(<span class="string">&#x27;labels&#x27;</span>).<span class="built_in">str</span>.split(by=<span class="string">&#x27; &#x27;</span>))  <span class="comment"># å°†&#x27;labels&#x27;åˆ—æŒ‰ç©ºæ ¼æ‹†åˆ†ä¸ºåˆ—è¡¨</span></span><br><span class="line">           .with_column(pl.lit(weight).alias(<span class="string">&#x27;vote&#x27;</span>))  <span class="comment"># æ–°å¢åä¸º&#x27;vote&#x27;çš„åˆ—ï¼Œå…¶ä¸­å¡«å……æƒé‡å€¼</span></span><br><span class="line">           .explode(<span class="string">&#x27;labels&#x27;</span>)  <span class="comment"># å±•å¼€&#x27;labels&#x27;åˆ—ä¸­çš„åˆ—è¡¨</span></span><br><span class="line">           .rename(&#123;<span class="string">&#x27;labels&#x27;</span>: <span class="string">&#x27;aid&#x27;</span>&#125;)  <span class="comment"># é‡å‘½å&#x27;labels&#x27;ä¸º&#x27;aid&#x27;</span></span><br><span class="line">           .with_column(pl.col(<span class="string">&#x27;aid&#x27;</span>).cast(pl.UInt32))  <span class="comment"># å°†&#x27;aid&#x27;åˆ—è½¬æ¢ä¸ºUInt32ç±»å‹</span></span><br><span class="line">           .with_column(pl.col(<span class="string">&#x27;vote&#x27;</span>).cast(pl.UInt8))  <span class="comment"># å°†&#x27;vote&#x27;åˆ—è½¬æ¢ä¸ºUInt8ç±»å‹</span></span><br><span class="line">   )</span><br><span class="line"><span class="comment"># æœ‰æ— æƒé‡</span></span><br><span class="line">subs = [read_sub(path) <span class="keyword">for</span> path <span class="keyword">in</span> paths]</span><br><span class="line">subs = [read_sub(path, weight) <span class="keyword">for</span> path, weight <span class="keyword">in</span> <span class="built_in">zip</span>(paths, [<span class="number">1</span>, <span class="number">0.55</span>, <span class="number">0.55</span>])]</span><br></pre></td></tr></table></figure>
<p>è¯»å–åçš„æ•°æ®ä¸º:</p>
<table>
<thead>
<tr>
<th>session_type</th>
<th>aid</th>
<th>vote</th>
</tr>
</thead>
<tbody>
<tr>
<td>1_clicks</td>
<td>1234</td>
<td>1</td>
</tr>
<tr>
<td>1_clicks</td>
<td>9841</td>
<td>1</td>
</tr>
<tr>
<td>2_clicks</td>
<td>5845</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>ç”±äºå†…å­˜é™åˆ¶,åªèƒ½è¿›è¡Œjoin:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">subs = subs[<span class="number">0</span>].join(subs[<span class="number">1</span>], how=<span class="string">&#x27;outer&#x27;</span>, on=[<span class="string">&#x27;session_type&#x27;</span>, <span class="string">&#x27;aid&#x27;</span>]).join(subs[<span class="number">2</span>], how=<span class="string">&#x27;outer&#x27;</span>, on=[<span class="string">&#x27;session_type&#x27;</span>, <span class="string">&#x27;aid&#x27;</span>], suffix=<span class="string">&#x27;_right2&#x27;</span>)</span><br><span class="line">subs.head()</span><br></pre></td></tr></table></figure>
<p>åˆå¹¶åçš„æ•°æ®</p>
<table>
<thead>
<tr>
<th>session_type</th>
<th>aid</th>
<th>vote</th>
<th>vote_right</th>
<th>vote_right2</th>
</tr>
</thead>
<tbody>
<tr>
<td>1_clicks</td>
<td>1234</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>1_clicks</td>
<td>9841</td>
<td>1</td>
<td>null</td>
<td>1</td>
</tr>
<tr>
<td>2_clicks</td>
<td>5845</td>
<td>1</td>
<td>1</td>
<td>null</td>
</tr>
<tr>
<td>2_clicks</td>
<td>8984</td>
<td>1</td>
<td>null</td>
<td>null</td>
</tr>
</tbody>
</table>
<p>ç”¨0å¡«å……nullå€¼,ç„¶åå¯¹voteæ±‚å’Œ,æ’åº:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">subs = (subs</span><br><span class="line">    .fill_null(<span class="number">0</span>)</span><br><span class="line">    .with_column((pl.col(<span class="string">&#x27;vote&#x27;</span>) + pl.col(<span class="string">&#x27;vote_right&#x27;</span>) + pl.col(<span class="string">&#x27;vote_right2&#x27;</span>)).alias(<span class="string">&#x27;vote_sum&#x27;</span>))</span><br><span class="line">    .drop([<span class="string">&#x27;vote&#x27;</span>, <span class="string">&#x27;vote_right&#x27;</span>, <span class="string">&#x27;vote_right2&#x27;</span>])</span><br><span class="line">    .sort(by=<span class="string">&#x27;vote_sum&#x27;</span>)</span><br><span class="line">    .reverse()</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>æ•°æ®å¦‚ä¸‹:</p>
<table>
<thead>
<tr>
<th>session_type</th>
<th>aid</th>
<th>vote_sum</th>
</tr>
</thead>
<tbody>
<tr>
<td>1_clicks</td>
<td>1234</td>
<td>3</td>
</tr>
<tr>
<td>2_clicks</td>
<td>5845</td>
<td>2</td>
</tr>
<tr>
<td>1_clicks</td>
<td>9841</td>
<td>2</td>
</tr>
</tbody>
</table>
<p>ç„¶åå¯¹æ¯ä¸ªç±»å‹é€‰æ‹©å‰20ä¸ªå•†å“,ç„¶åèšåˆæˆæ•°ç»„:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">preds = subs.groupby(<span class="string">&#x27;session_type&#x27;</span>).agg([</span><br><span class="line">    pl.col(<span class="string">&#x27;aid&#x27;</span>).head(<span class="number">20</span>).alias(<span class="string">&#x27;labels&#x27;</span>)</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">preds = preds.with_column(pl.col(<span class="string">&#x27;labels&#x27;</span>).apply(<span class="keyword">lambda</span> lst: <span class="string">&#x27; &#x27;</span>.join([<span class="built_in">str</span>(aid) <span class="keyword">for</span> aid <span class="keyword">in</span> lst])))</span><br></pre></td></tr></table></figure>
<h3 id="matrix-factorization-pytorchmerlin-dataloader"><a class="markdownIt-Anchor" href="#matrix-factorization-pytorchmerlin-dataloader"></a> ğŸ’¡Matrix Factorization [PyTorch+Merlin Dataloader]</h3>
<p>ä¸word2vecç±»ä¼¼,ä½¿ç”¨çŸ©é˜µåˆ†è§£æ¥è·å–å•†å“çš„åµŒå…¥å‘é‡</p>
<p><a target="_blank" rel="noopener" href="https://www.kaggle.com/code/cpmpml/matrix-factorization-with-gpu">ğŸ’¡Matrix Factorization with GPU [PyTorch+Merlin Dataloader]</a></p>
<p>ä½¿ç”¨Pytorchçš„Embeddingå±‚æ¥è®­ç»ƒå•†å“çš„åµŒå…¥å‘é‡,ç„¶åä½¿ç”¨è¿™äº›å‘é‡æ¥è®¡ç®—å•†å“idä¹‹é—´çš„ç›¸ä¼¼åº¦.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ„å»ºaid_pairs</span></span><br><span class="line">train_pairs = cudf.concat([train, test])[[<span class="string">&#x27;session&#x27;</span>, <span class="string">&#x27;aid&#x27;</span>]]</span><br><span class="line"><span class="keyword">del</span> train, test</span><br><span class="line"></span><br><span class="line">train_pairs[<span class="string">&#x27;aid_next&#x27;</span>] = train_pairs.groupby(<span class="string">&#x27;session&#x27;</span>).aid.shift(-<span class="number">1</span>)</span><br><span class="line">train_pairs = train_pairs[[<span class="string">&#x27;aid&#x27;</span>, <span class="string">&#x27;aid_next&#x27;</span>]].dropna().reset_index(drop=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>aid</th>
<th>aid_next</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>2</td>
</tr>
<tr>
<td>2</td>
<td>3</td>
</tr>
<tr>
<td>3</td>
<td>4</td>
</tr>
</tbody>
</table>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"><span class="comment"># WordEmbeddingæ¨¡å‹</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MatrixFactorization</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, n_aids, n_factors</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.aid_factors = nn.Embedding(n_aids, n_factors, sparse=<span class="literal">True</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, aid1, aid2</span>):</span><br><span class="line">        aid1 = self.aid_factors(aid1)</span><br><span class="line">        aid2 = self.aid_factors(aid2)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> (aid1 * aid2).<span class="built_in">sum</span>(dim=<span class="number">1</span>)</span><br><span class="line"><span class="comment"># è¯„ä»·æŒ‡æ ‡</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AverageMeter</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Computes and stores the average and current value&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, fmt=<span class="string">&#x27;:f&#x27;</span></span>):</span><br><span class="line">        self.name = name</span><br><span class="line">        self.fmt = fmt</span><br><span class="line">        self.reset()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">reset</span>(<span class="params">self</span>):</span><br><span class="line">        self.val = <span class="number">0</span></span><br><span class="line">        self.avg = <span class="number">0</span></span><br><span class="line">        self.<span class="built_in">sum</span> = <span class="number">0</span></span><br><span class="line">        self.count = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">self, val, n=<span class="number">1</span></span>):</span><br><span class="line">        self.val = val</span><br><span class="line">        self.<span class="built_in">sum</span> += val * n</span><br><span class="line">        self.count += n</span><br><span class="line">        self.avg = self.<span class="built_in">sum</span> / self.count</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        fmtstr = <span class="string">&#x27;&#123;name&#125; &#123;val&#x27;</span> + self.fmt + <span class="string">&#x27;&#125; (&#123;avg&#x27;</span> + self.fmt + <span class="string">&#x27;&#125;)&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> fmtstr.<span class="built_in">format</span>(**self.__dict__)    </span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®­ç»ƒ</span></span><br><span class="line">model.to(<span class="string">&#x27;cuda&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(num_epochs):</span><br><span class="line">    <span class="keyword">for</span> batch, _ <span class="keyword">in</span> train_dl_merlin:</span><br><span class="line">        model.train()</span><br><span class="line">        losses = AverageMeter(<span class="string">&#x27;Loss&#x27;</span>, <span class="string">&#x27;:.4e&#x27;</span>)</span><br><span class="line">            </span><br><span class="line">        aid1, aid2 = batch[<span class="string">&#x27;aid&#x27;</span>], batch[<span class="string">&#x27;aid_next&#x27;</span>]</span><br><span class="line">        aid1 = aid1.to(<span class="string">&#x27;cuda&#x27;</span>)</span><br><span class="line">        aid2 = aid2.to(<span class="string">&#x27;cuda&#x27;</span>)</span><br><span class="line">        output_pos = model(aid1, aid2)</span><br><span class="line">        output_neg = model(aid1, aid2[torch.randperm(aid2.shape[<span class="number">0</span>])])</span><br><span class="line">        </span><br><span class="line">        output = torch.cat([output_pos, output_neg])</span><br><span class="line">        targets = torch.cat([torch.ones_like(output_pos), torch.zeros_like(output_pos)])</span><br><span class="line">        loss = criterion(output, targets)</span><br><span class="line">        losses.update(loss.item())</span><br><span class="line">        </span><br><span class="line">        optimizer.zero_grad()</span><br><span class="line">        loss.backward()</span><br><span class="line">        optimizer.step()</span><br><span class="line">        </span><br><span class="line">    model.<span class="built_in">eval</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        accuracy = AverageMeter(<span class="string">&#x27;accuracy&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> batch, _ <span class="keyword">in</span> valid_dl_merlin:</span><br><span class="line">            aid1, aid2 = batch[<span class="string">&#x27;aid&#x27;</span>], batch[<span class="string">&#x27;aid_next&#x27;</span>]</span><br><span class="line">            output_pos = model(aid1, aid2)</span><br><span class="line">            output_neg = model(aid1, aid2[torch.randperm(aid2.shape[<span class="number">0</span>])])</span><br><span class="line">            accuracy_batch = torch.cat([output_pos.sigmoid() &gt; <span class="number">0.5</span>, output_neg.sigmoid() &lt; <span class="number">0.5</span>]).<span class="built_in">float</span>().mean()</span><br><span class="line">            accuracy.update(accuracy_batch, aid1.shape[<span class="number">0</span>])</span><br><span class="line">            </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;epoch+<span class="number">1</span>:02d&#125;</span>: * TrainLoss <span class="subst">&#123;losses.avg:<span class="number">.3</span>f&#125;</span>  * Accuracy <span class="subst">&#123;accuracy.avg:<span class="number">.3</span>f&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è·å–åµŒå…¥å¹¶è®¡ç®—ç›¸ä¼¼åº¦</span></span><br><span class="line">embeddings = model.aid_factors.weight.detach().cpu().numpy()</span><br><span class="line"></span><br><span class="line">knn = NearestNeighbors(n_neighbors=<span class="number">21</span>, metric=<span class="string">&#x27;euclidean&#x27;</span>)</span><br><span class="line">knn.fit(embeddings)</span><br><span class="line"></span><br><span class="line">_, aid_nns = knn.kneighbors(embeddings)</span><br><span class="line"></span><br><span class="line">sample_sub = pd.read_csv(<span class="string">&#x27;../input/otto-recommender-system//sample_submission.csv&#x27;</span>)</span><br><span class="line">test = cudf.read_parquet(<span class="string">&#x27;../input/otto-full-optimized-memory-footprint/test.parquet&#x27;</span>)</span><br><span class="line"></span><br><span class="line">session_types = [<span class="string">&#x27;clicks&#x27;</span>, <span class="string">&#x27;carts&#x27;</span>, <span class="string">&#x27;orders&#x27;</span>]</span><br><span class="line">gr = test.reset_index(drop=<span class="literal">True</span>).to_pandas().groupby(<span class="string">&#x27;session&#x27;</span>)</span><br><span class="line">test_session_AIDs = gr[<span class="string">&#x27;aid&#x27;</span>].apply(<span class="built_in">list</span>)</span><br><span class="line">test_session_types = gr[<span class="string">&#x27;type&#x27;</span>].apply(<span class="built_in">list</span>)</span><br><span class="line"></span><br><span class="line">labels = []</span><br><span class="line"></span><br><span class="line">type_weight_multipliers = &#123;<span class="number">0</span>: <span class="number">1</span>, <span class="number">1</span>: <span class="number">6</span>, <span class="number">2</span>: <span class="number">3</span>&#125;</span><br><span class="line"><span class="keyword">for</span> AIDs, types <span class="keyword">in</span> <span class="built_in">zip</span>(test_session_AIDs, test_session_types):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(AIDs) &gt;= <span class="number">20</span>:</span><br><span class="line">        <span class="comment"># if we have enough aids (over equals 20) we don&#x27;t need to look for candidates! we just use the old logic</span></span><br><span class="line">        weights=np.logspace(<span class="number">0.1</span>,<span class="number">1</span>,<span class="built_in">len</span>(AIDs),base=<span class="number">2</span>, endpoint=<span class="literal">True</span>)-<span class="number">1</span></span><br><span class="line">        aids_temp=defaultdict(<span class="keyword">lambda</span>: <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">for</span> aid,w,t <span class="keyword">in</span> <span class="built_in">zip</span>(AIDs,weights,types): </span><br><span class="line">            aids_temp[aid]+= w * type_weight_multipliers[t]</span><br><span class="line">            </span><br><span class="line">        sorted_aids=[k <span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="built_in">sorted</span>(aids_temp.items(), key=<span class="keyword">lambda</span> item: -item[<span class="number">1</span>])]</span><br><span class="line">        labels.append(sorted_aids[:<span class="number">20</span>])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># here we don&#x27;t have 20 aids to output -- we will use approximate nearest neighbor search and our embeddings</span></span><br><span class="line">        <span class="comment"># to generate candidates!</span></span><br><span class="line">        AIDs = <span class="built_in">list</span>(<span class="built_in">dict</span>.fromkeys(AIDs[::-<span class="number">1</span>]))</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># let&#x27;s grab the most recent aid</span></span><br><span class="line">        most_recent_aid = AIDs[<span class="number">0</span>]</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># and look for some neighbors!</span></span><br><span class="line">        nns = <span class="built_in">list</span>(aid_nns[most_recent_aid])</span><br><span class="line">                        </span><br><span class="line">        labels.append((AIDs+nns)[:<span class="number">20</span>])</span><br><span class="line"></span><br><span class="line">labels_as_strings = [<span class="string">&#x27; &#x27;</span>.join([<span class="built_in">str</span>(l) <span class="keyword">for</span> l <span class="keyword">in</span> lls]) <span class="keyword">for</span> lls <span class="keyword">in</span> labels]</span><br><span class="line"></span><br><span class="line">predictions = pd.DataFrame(data=&#123;<span class="string">&#x27;session_type&#x27;</span>: test_session_AIDs.index, <span class="string">&#x27;labels&#x27;</span>: labels_as_strings&#125;)</span><br><span class="line"></span><br><span class="line">prediction_dfs = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> st <span class="keyword">in</span> session_types:</span><br><span class="line">    modified_predictions = predictions.copy()</span><br><span class="line">    modified_predictions.session_type = modified_predictions.session_type.astype(<span class="string">&#x27;str&#x27;</span>) + <span class="string">f&#x27;_<span class="subst">&#123;st&#125;</span>&#x27;</span></span><br><span class="line">    prediction_dfs.append(modified_predictions)</span><br><span class="line"></span><br><span class="line">submission = pd.concat(prediction_dfs).reset_index(drop=<span class="literal">True</span>)</span><br><span class="line">submission.to_csv(<span class="string">&#x27;submission.csv&#x27;</span>, index=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>
<h3 id="226th-place-solution-two-cents-from-a-first-timer"><a class="markdownIt-Anchor" href="#226th-place-solution-two-cents-from-a-first-timer"></a> 226th (?!) Place Solution &amp; Two-cents from a First-timer</h3>
<p><a target="_blank" rel="noopener" href="https://www.kaggle.com/competitions/otto-recommender-system/discussion/383657">226th (?!) Place Solution &amp; Two-cents from a First-timer</a></p>
<p><img src="https://image.yayan.xyz/20240316125957.png" alt="" /></p>
<ol>
<li>Item Co-visitation Matrix<br />
entirely based one Chrisâ€™ notebook</li>
</ol>
<ul>
<li>Order matrix: Click/cart/order to click/cart/order with type weighting</li>
<li>Buy2buy matrix: Cart/order to cart/order</li>
<li>Click matrix: click/cart/order to clicks with time weighting</li>
</ul>
<ol start="2">
<li>Feature Feneration</li>
</ol>
<ul>
<li>
<p>Item features (for each aid)</p>
</li>
<li>
<ul>
<li>Count of events (click/cart/order)</li>
</ul>
</li>
<li>
<ul>
<li>Sum of event weight</li>
</ul>
</li>
<li>
<ul>
<li>Quarter of day (QoD) with most events (0-3)</li>
</ul>
</li>
<li>
<ul>
<li>Day of week (DoW) with most events (0-6)</li>
</ul>
</li>
<li>
<p>User features (for each session)</p>
</li>
<li>
<ul>
<li>Count of events (click/cart/order) and interacted items (aid)</li>
</ul>
</li>
<li>
<ul>
<li>Sum of event weight</li>
</ul>
</li>
<li>
<ul>
<li>QoD with most events (0-3)</li>
</ul>
</li>
<li>
<ul>
<li>DoW with most events (0-6)</li>
</ul>
</li>
<li>
<ul>
<li>Number of days with events</li>
</ul>
</li>
<li>
<ul>
<li>Days from first to last events</li>
</ul>
</li>
<li>
<p>User-item features (for each session-aid pair)</p>
</li>
<li>
<ul>
<li>Count of events (click/cart/order) and interacted items (aid)</li>
</ul>
</li>
<li>
<ul>
<li>Sum of event weight</li>
</ul>
</li>
<li>
<ul>
<li>QoD with most events in both categorical (0-3) and one-hot encoded (0/1 for each) format</li>
</ul>
</li>
<li>
<ul>
<li>DoW with most events in both categorical (0-6) and one-hot encoded (0/1 for each) format</li>
</ul>
</li>
<li>
<ul>
<li>last_n = item_chronological_rank / user_total_event_count</li>
</ul>
</li>
<li>
<ul>
<li>last_ts = (user_item_last_timestamp - start_week_timestamp) / (end_week_timestamp - start_week_timestamp)</li>
</ul>
</li>
</ul>
<ol start="3">
<li>Candidate Selection<br />
partly based on Chrisâ€™ notebook<br />
For each session,I select top X most relevant items in each event type</li>
</ol>
<ul>
<li>ä¼šè¯å•å‡»/ç‚¹é€‰/è®¢è´­é¡¹ç›®çš„æ¬¡æ•°</li>
<li>å…±è®¿æƒæ€»å’Œ</li>
<li>è¯¥å•†å“æ˜¯å¦ä¸ºæœ¬å‘¨ç‚¹å‡»æ¬¡æ•°æœ€å¤š/è´­ä¹°æ¬¡æ•°æœ€å¤šçš„å•†å“</li>
</ul>
<ol start="4">
<li>Ranker</li>
</ol>
<ul>
<li>Rule-base ranker in Chrisâ€™ notebook</li>
<li>XGBRanker with <code>rank:pairwise</code> objective</li>
<li>
<ul>
<li>the model is overfitting and requires a lot of hyperparameter tuning</li>
</ul>
</li>
</ul>
<ol start="5">
<li>Solution Ensemble</li>
</ol>
<ul>
<li>use their public LB scores as weights</li>
<li>Ensemble of XGBRanker above and public submissions</li>
<li>Ensemble of above two ranker methods and public submissions</li>
</ul>
<p>6, what have I learned</p>
<ul>
<li>read the discussion and notebooks forums</li>
<li>try as many ideas as possible</li>
<li>know every line of code you write</li>
</ul>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>æœ¬æ–‡é“¾æ¥ï¼š</strong>
      <a href="https://gladdduck.github.io/2024/03/14/%E5%AE%9E%E4%B9%A0-Kaggle-OTTO%E6%AF%94%E8%B5%9B%E5%9B%9E%E9%A1%BE/" title="Kaggle-OTTOæ¯”èµ›å›é¡¾" target="_blank" rel="external">https://gladdduck.github.io/2024/03/14/å®ä¹ -Kaggle-OTTOæ¯”èµ›å›é¡¾/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>ç‰ˆæƒå£°æ˜ï¼š </strong> æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CNåè®®</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://github.com/gladdduck" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/icon.png" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://github.com/gladdduck" target="_blank"><span class="text-dark">Gladdduck</span><small class="ml-1x">KB Master</small></a></h3>
        <div>æˆ‘å†™çš„ä¸ªäººç®€ä»‹ã€‚</div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    
  <section id="comments">
  	
           
    
  </section>


  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2024/03/16/%E5%AE%9E%E4%B9%A0-Hadoop%E7%9F%A5%E8%AF%86%E7%82%B9/" title="Hadoopå­¦ä¹ ç¬”è®°"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;ä¸Šä¸€ç¯‡</span></a>
    </li>
    
    
    <li class="next">
      <a href="/2024/03/11/%E9%85%8D%E7%BD%AE-vscode%E5%85%8D%E5%AF%86%E8%BF%9E%E6%8E%A5%E6%9C%8D%E5%8A%A1%E5%99%A8/" title="vscodeå…å¯†è¿æ¥æœåŠ¡å™¨"><span>ä¸‹ä¸€ç¯‡&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
    <li class="toggle-toc">
      <a class="toggle-btn " data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="æ–‡ç« ç›®å½•" role="button">    <span>[&nbsp;</span><span>æ–‡ç« ç›®å½•</span>
        <i class="text-collapsed icon icon-anchor"></i>
        <i class="text-in icon icon-close"></i>
        <span>]</span>
      </a>
    </li>
    
  </ul>
  
  
  <!-- Button trigger modal -->
  <button type="button" class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle="modal" data-target="#donateModal"><span>èµ</span></button>
  <!-- <div class="wave-icon wave-icon-danger btn-donate" data-toggle="modal" data-target="#donateModal">
    <div class="wave-circle"><span class="icon"><i class="icon icon-bill"></i></span></div>
  </div> -->
  
  
  <div class="bar-right">
    
    <div class="share-component" data-sites="weibo,qq,wechat" data-mobile-sites="weibo,qq,wechat"></div>
    
  </div>
  </div>
</nav>
  
<!-- Modal -->
<div class="modal modal-center modal-small modal-xs-full fade" id="donateModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content donate">
      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <div class="modal-body">
        <div class="donate-box">
          <div class="donate-head">
            <p>æ„Ÿè°¢æ‚¨çš„æ”¯æŒï¼Œæˆ‘ä¼šç»§ç»­åŠªåŠ›çš„!</p>
          </div>
          <div class="tab-content">
            <div role="tabpanel" class="tab-pane fade active in" id="alipay">
              <div class="donate-payimg">
                <img src="/images/donate/donate.png" alt="æ‰«ç æ”¯æŒ" title="æ‰«ä¸€æ‰«" />
              </div>
              <p class="text-muted mv">æ‰«ç æ‰“èµï¼Œä½ è¯´å¤šå°‘å°±å¤šå°‘</p>
              <p class="text-grey">æ‰“å¼€æ”¯ä»˜å®æ‰«ä¸€æ‰«ï¼Œå³å¯è¿›è¡Œæ‰«ç æ‰“èµå“¦</p>
            </div>
            <div role="tabpanel" class="tab-pane fade" id="wechatpay">
              <div class="donate-payimg">
                <img src="/images/donate/donate.png" alt="æ‰«ç æ”¯æŒ" title="æ‰«ä¸€æ‰«" />
              </div>
              <p class="text-muted mv">æ‰«ç æ‰“èµï¼Œä½ è¯´å¤šå°‘å°±å¤šå°‘</p>
              <p class="text-grey">æ‰“å¼€å¾®ä¿¡æ‰«ä¸€æ‰«ï¼Œå³å¯è¿›è¡Œæ‰«ç æ‰“èµå“¦</p>
            </div>
          </div>
          <div class="donate-footer">
            <ul class="nav nav-tabs nav-justified" role="tablist">
              <li role="presentation" class="active">
                <a href="#alipay" id="alipay-tab" role="tab" data-toggle="tab" aria-controls="alipay" aria-expanded="true"><i class="icon icon-alipay"></i> æ”¯ä»˜å®</a>
              </li>
              <li role="presentation" class="">
                <a href="#wechatpay" role="tab" id="wechatpay-tab" data-toggle="tab" aria-controls="wechatpay" aria-expanded="false"><i class="icon icon-wepay"></i> å¾®ä¿¡æ”¯ä»˜</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>



</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/gladdduck" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        <div class="publishby">
        	Theme by <a href="https://github.com/cofess" target="_blank"> cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.
        </div>
    </div>
</footer>
  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'æ–‡ç« ',
            PAGES: 'é¡µé¢',
            CATEGORIES: 'åˆ†ç±»',
            TAGS: 'æ ‡ç­¾',
            UNTITLED: '(æœªå‘½å)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>






   
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





   
    
  <!-- <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"> -->
  <script src="//cdn.jsdelivr.net/npm/gitalk@1.6.2/dist/gitalk.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script>
  <script type="text/javascript">
  var gitalk = new Gitalk({
    clientID: '644a1091cfd20b8f33ef',
    clientSecret: '4c5cc91dbfe067c804fcef958817d41acc9ba545',
    repo: 'gladdduck.github.io',
    owner: 'gladdduck',
    admin: ['gladdduck'],
    id: md5(location.pathname),
    distractionFreeMode: true,
    language: 'zh-CN',
    enableHotKey: ''
  })
  gitalk.render('comments')
  </script>
      







</body>
</html>